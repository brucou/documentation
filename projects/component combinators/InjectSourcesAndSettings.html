

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>InjectSourcesAndSettings — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="InjectSourcesAndSettings — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="InjectSourcesAndSettings — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">    <div id="mobile-bar">
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Blog</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Blog</a>
</li>

    </ul>
  </div>

<div class="content  ">
  
  
    <h1>InjectSourcesAndSettings</h1>
  
  
    <h1 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h1><p>The <code>InjectSourcesAndSettings</code> component allows to add BOTH sources and settings to an existing set of sources and settings. Those extra sources will be constructed from the existing sources and settings. </p>
<p>Typically: </p>
<ul>
<li>extra sources can be :<ul>
<li>events (user clicks), </li>
<li>behaviours (current content of database table), </li>
<li>‘reactive behaviours’ (which are both events and behaviours - to use wisely<sup><a href="#fn_behaviour" id="reffn_behaviour">behaviour</a></sup><ul>
<li>always hold a current value</li>
<li>pass on update events</li>
</ul>
</li>
</ul>
</li>
<li>extra settings can be :<ul>
<li>trace information, to get a feeling of where in the component hierarchy a log points at</li>
<li>parameters to be passed to all downstreams components<ul>
<li><code>sinkNames</code> is a common case</li>
</ul>
</li>
<li>well anything really, dictated by the matter at hand, and representing a parameterization<br>concern</li>
</ul>
</li>
</ul>
<p>The important point about sources and settings, for instance in <code>InjectSourcesAndSettings
(settings, [comp1, comp2]))</code>, is that they will be passed on to both components. If those<br>components further decompose into children components, those children will also be passed those<br>sources and settings, according to the defined [precedence rules]<br>(/projects/component-combinators/mm/#description). This behaviour is hence similar to inheritance in a class hierarchy context, and we will call that settings inheritance.</p>
<blockquote id="fn_behaviour">
<sup>behaviour</sup>. we are making semantics distinctions here. At the implementation level, behaviours <a href="#reffn_behaviour" title="Jump back to footnote [behaviour] in the text."> &#8617;</a>
</blockquote>
<p>and reactive behaviours are the same objects. However, it is understood that restricting that<br>object to be combined with other events only through <code>sample</code> and <code>withLatestFrom</code>, we achieve<br>the necessary behaviour semantics. Using the same object with <code>combineLatest</code> gives us the <em>reactive behaviour</em><br>semantics.</p>
<p><strong>NOTE:</strong> It has been deemed better to have a <code>InjectSources</code> and a <code>InjectSourcesAndSettings</code> component rather than a <code>InjectSources</code>  and <code>InjectSettings</code>  function, based on hypothesis on frecuency of appearance of such configuration needs. As these components will be more tested in the field, the API might change. In any case, this is a rather minor point.</p>
<h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><h2 id="InjectSourcesAndSettings-InjectSourcesAndSettingsSettings-gt-Component-gt-InjectSourcesAndSettingsComponent"><a href="#InjectSourcesAndSettings-InjectSourcesAndSettingsSettings-gt-Component-gt-InjectSourcesAndSettingsComponent" class="headerlink" title="InjectSourcesAndSettings :: InjectSourcesAndSettingsSettings -&gt; [Component] -&gt; InjectSourcesAndSettingsComponent"></a>InjectSourcesAndSettings :: InjectSourcesAndSettingsSettings -&gt; [Component] -&gt; InjectSourcesAndSettingsComponent</h2><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>Creates a component which will execute the <code>[Component]</code> with additional sources and settings as per configuration of its <code>InjectSourcesAndSettingsSettings</code> parameter.</p>
<p>It is important to understand well the semantics of sources to create them in a safe and bug-free way.</p>
<p>It is important to understand well the mechanism of settings inheritance to so they propagate correctly and result in the expected effects. In particular, what is really important to understand is the <a href="/projects/component-combinators/mm/#description">precedence rules</a>.</p>
<ul>
<li>injected settings follow a scoping mechanism similar to that of <code>let</code> javascript variables. An injected settings property will be visible in any downstream component. That settings property can be redefined at any level of the hierarchy, and the same visibility rules will apply to that redefinition.</li>
<li>for instance with <code>let</code><ul>
<li><code>function letTest() {
let x = 1;
if (true) {
  let x = 2;  // different variable
  console.log(x);  // 2
}
console.log(x);  // 1
}</code></li>
</ul>
</li>
<li>for instance with <code>InjectSourcesAndSettings</code><ul>
<li><code>InjectSourcesAndSettings({ settings: { trace: &#39;top level&#39; } }, [
SomeComponent,
ForEach({ items: &#39;items&#39;, as: &#39;things&#39;, trace: &#39;for each level&#39; }, [
SomeOtherComponent,
ListOf({ list: &#39;list&#39;, as: &#39;element&#39;, trace: &#39;list of level&#39; })
])
ThirdComponent
]</code><br><code>SomeComponent</code> will see <code>trace</code> set to <code>&#39;top level&#39;</code> while <code>SomeOtherComponent</code> will see <code>trace</code> set to <code>&#39;for each level&#39;</code> and <code>ThirdComponent</code> will see again <code>trace</code> set to ‘top level’</li>
</ul>
</li>
</ul>
<p>The parametrization is as follows :</p>
<ul>
<li>the <code>sourcesFactory</code> parameter maps to a function which creates a hash of sources from the current sources and settings</li>
<li>the <code>settings</code> property (or the object resulting from executing the setting factory if that applies) merges together with the existing settings to create new settings that will be passed to the <code>[Component]</code></li>
</ul>
<p>The behaviour is as follows :</p>
<ul>
<li>the sources to inject are created according to the logic enclosed in the factory</li>
<li>children component are called with a <code>sources</code> parameter which is the merge of the previous <code>sources</code> and the injected sources. </li>
<li>In case of conflict (injected a source with same name than an existing one), the injected source has priority</li>
<li>the newly injected and merged <code>sources</code> object is used for every configured function which uses a <code>sources</code> parameter</li>
<li>the settings to inject are merged with the existing settings according to the precedence rules presented previously.</li>
<li>the newly injected and merged <code>settings</code> object is used for every configured function which uses a <code>settings</code> parameter (within the scope of the precedence rules)</li>
</ul>
<h3 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h3><ul>
<li><code>InjectSourcesComponent:: Component</code></li>
<li><code>InjectSourcesSettings :: Record {</code></li>
<li><code>sourcesFactory :: SourcesFactory,</code></li>
<li><code>settings :: Settings || SettingsFactory</code></li>
<li><code>}</code></li>
<li><code>SourcesFactory :: Sources -&gt; Settings -&gt; Sources</code></li>
<li><code>SettingsFactory :: Settings -&gt; Settings</code></li>
<li><code>Sources :: HashMap&lt;SourceName, Source&gt;</code></li>
</ul>
<h3 id="Contracts"><a href="#Contracts" class="headerlink" title="Contracts"></a>Contracts</h3><ul>
<li>one of <code>sourcesFactory</code> or <code>settings</code> must be present in <code>InjectSourcesSettings</code></li>
</ul>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><p><strong>TODO TESTS showing the settings inheritance…, no demo</strong></p>
<h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><ul>
<li>It is very important to distinguish between event sources and behaviour sources. The first ones should be multicasted (<code>.share()</code> with Rxjs), while the second one should be memoized (<code>.shareReplay(1)</code> with Rxjs). Failure to do so is the major source of productivity loss when programming with streams. Given the hard task which is debugging in the context of streams, it is highly recommended to think about the nature of the injected source beforehand and implement it accordingly.</li>
<li>it is very important to understand the mechanism of settings inheritance down the component tree</li>
</ul>

  
  
  <div class="footer">
    Caught a mistake?
    <a href="https://github.com/brucou/kingly-site/tree/master/src/projects/component combinators/InjectSourcesAndSettings.md" rel="noopener" target="_blank">
            Edit this on GitHub!
    </a><br>
    Can we help you?     <a href="https://github.com/brucou/kingly/discussions/new" rel="noopener" target="_blank">
      Let us know!
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
</html>
