

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>Svelte Suspense — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Svelte Suspense — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Svelte Suspense — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="mobile-bar">
      <a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link current">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link current">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Blog</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link current">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link current">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Blog</a>
</li>

    </ul>
    <div class="list">
      
        <h2>
          
          Examples
          
            <select class="version-select">
              <option value="SELF" selected>1.0</option>
            </select>
          
        </h2>
        <ul class="menu-root">
  
    
    
    
    <li>
      <a href="/documentation/v1/examples/index.html" class="sidebar-link">Introduction</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/examples/counter-application.html" class="sidebar-link">Counter application</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/examples/keypad.html" class="sidebar-link">Keypad</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/examples/two-players-chess-game.html" class="sidebar-link">Two-players chess game</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/examples/online-TMDB-interface.html" class="sidebar-link">Online interface to TMDB movie database</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/examples/svelte suspense.html" class="sidebar-link current new">Svelte Suspense</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/examples/wizard-form.html" class="sidebar-link new">Wizard form</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>



<div class="content examples with-sidebar ">
  
    
    
  
  
    <h1>Svelte Suspense</h1>
  
  
    <h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><p>This example illustrates a simple hierarchical state machine implementing a behavior similar to React Suspense. It also showcases how a state machine definition can be compiled into a standard standalone JavaScript function — this is a key motivation behind Kingly’s API design. Compiling the machine allows us to mostly eliminate the footprint linked to the machine library.</p>
<h2 id="Modelization"><a href="#Modelization" class="headerlink" title="Modelization"></a>Modelization</h2><p>The suspense functionality can be summarized by the following state machine:</p>
<p><img src="../../graphs/suspense%20machine.png" alt="suspense finite state machine"></p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p><img src="../../images/suspense/suspense%20demo.gif" alt="suspense demo"></p>
<p>Clone the <a href="https://github.com/brucou/svelte-suspense-app" target="_blank" rel="noopener">GitHub repository</a>. </p>
<pre><code class="hljs bash">npm install
npm run start</code></pre>
<h3 id="Markup-and-semantics"><a href="#Markup-and-semantics" class="headerlink" title="Markup and semantics"></a>Markup and semantics</h3><p>The main screen which will hold the loaded image is handled with a suspense functionality:</p>
<pre><code class="hljs html">let albums=[];

function fetchAlbums(intents)&#123;
  const &#123;done, failed&#125; = intents;
  axios.get(iTunesUrl)
       .then(res =&gt; res.data.feed.entry)
       .then(done)
       .catch(failed)
&#125;
 
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"albums"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">task</span>=<span class="hljs-string">&#123;fetchAlbums&#125;</span> <span class="hljs-attr">let:data</span>=<span class="hljs-string">&#123;albums&#125;</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">10</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"fallback"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"album-img"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://media.giphy.com/media/y1ZBcOGOOtlpC/200.gif"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"error"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"album-img"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ERROR!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">LazyLoadContainer</span>&gt;</span>
                &#123;#if albums&#125;
                  &#123;#each albums as album, i&#125;
                  <span class="hljs-tag">&lt;<span class="hljs-name">LazyLoad</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"&#123;i&#125;"</span>&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">Album</span> &#123;<span class="hljs-attr">album</span>&#125; /&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">LazyLoad</span> &gt;</span>
                  &#123;/each&#125;
                &#123;/if &#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">LazyLoadContainer</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>
<p>The default slot content of the <code>Suspense</code> component will be immediately put in the DOM and hidden (<code>display: none</code>). Two things can happen:</p>
<ul>
<li>completion is signaled (<code>done</code> or <code>failed</code>) before <code>timeout</code> milliseconds. In that case, the corresponding slot content (default slot or <code>error</code> slot) is displayed as soon as the completion signal is processed</li>
<li>completion is not signaled before <code>timeout</code> milliseconds expires. In that case, the fallback content (e.g. the <code>fallback</code> slot content) will be displayed. When the default slot content signals completion, it will be displayed. When completion is signaled (<code>done</code> or <code>failed</code>), the corresponding slot content (default slot or <code>error</code> slot) is displayed as soon as the completion signal is processed</li>
</ul>
<p>The <code>Album</code> component also benefits from the suspense functionality:</p>
<pre><code class="hljs javascript">&lt;ul <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"album"</span>&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"album-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">let:intents</span>=<span class="hljs-string">&#123;&#123;done,</span> <span class="hljs-attr">failed</span>&#125;&#125; <span class="hljs-attr">timeout</span>=<span class="hljs-string">0</span> &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"fallback"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"album-img"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"loading"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://media.giphy.com/media/y1ZBcOGOOtlpC/200.gif"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#123;link&#125;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"blank"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"link"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"album-img"</span>
                     <span class="hljs-attr">on:load</span>=<span class="hljs-string">"&#123;done&#125;"</span>
                     <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;image&#125;</span>
                     <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;</span>'<span class="hljs-attr">itunes</span>' + <span class="hljs-attr">Math.random</span>()&#125; /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title album-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#123;link&#125;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"blank"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"link"</span>&gt;</span>
            &#123;title.slice(0, 20)&#125;..<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"price album-item"</span>&gt;</span>Price:&#123;price&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"date album-item"</span>&gt;</span>Released:&#123;formatDate(date, "MMM Do YY")&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span></code></pre>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>The <code>Suspense</code> component admits the following props:</p>
<ul>
<li><code>timeout</code>: the number of milliseconds to wait before displaying the fallback slot content</li>
<li><code>task</code>: a function to run on starting the <code>Suspense</code> component. That function will receive an object parameter <code>{done, failed}</code> which can be used to indicate termination or failure to the underlying suspense state machine. </li>
</ul>
<p>The <code>Suspense</code> component also passes on the <code>intents</code> parameter to its children slots. The aforementioned parameter is an object with properties <code>{done, failed}</code> which can be used to indicate termination or failure to the underlying suspense state machine. Both properties are function which can also pass event data if necessary.  </p>
<p>For instance, in the previous example, the <code>Album</code> component lazily loads an image. When the image is loaded, completion is signaled and the wrapping <code>&lt;a&gt;</code> DOM element is displayed. In this example, there is no need to pass data with the <code>done</code> or <code>failed</code> events. </p>
<p>In the previous example too, in the main <code>App</code> component, the list of albums is fetched, using the <code>task</code> parameter of the <code>Suspense</code> component. When that is completed, the completion signal with the fetched albums as data is sent to the <code>Suspense</code> component and the album list is displayed. </p>
<h2 id="Takeaways"><a href="#Takeaways" class="headerlink" title="Takeaways"></a>Takeaways</h2><p>Kingly machines can be compiled to standard standalone JavaScript functions. The size of the Kingly library is in this case become much less relevant. Kingly takes inspiration here from <a href="https://svelte.dev/" target="_blank" rel="noopener">Svelte</a>, the front-end framework which compiles itself away.</p>
<p>While using a formalized state machine may feel like too much for a simple behavior like Suspense, the technique can however be generalized easily to more complex scenarios — only by modifying the underlying machine. Using a Kingly state machine with Svelte is likely to improve Svelte’s testing history, which is mostly based on end-to-end tests. A Svelte component is a sum of behavior, style, and content. If the behavior is implemented with a Kingly machine, input sequences for the machine can be generated automatically, and testing can be performed independently of the browser or Svelte. </p>
<h2 id="Credit"><a href="#Credit" class="headerlink" title="Credit"></a>Credit</h2><p>The example is inspired from <a href="https://reactgo.com/tutorial-reactlazy-react-suspense/" target="_blank" rel="noopener">previous work</a> by <a href="https://twitter.com/saigowthamr" target="_blank" rel="noopener">Sai gowtham</a>.</p>

  
  
  <div class="footer">
    Caught a mistake?
    <a href="https://github.com/brucou/kingly-site/tree/master/src/v1/examples/svelte suspense.md" rel="noopener" target="_blank">
            Edit this on GitHub!
    </a><br>
    Can we help you?     <a href="https://github.com/brucou/kingly/discussions/new" rel="noopener" target="_blank">
      Let us know!
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
