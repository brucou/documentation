

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>Implementing UIs with state machines — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Implementing UIs with state machines — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Implementing UIs with state machines — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">    <div id="mobile-bar">
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link current">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link current">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

    </ul>
    <div class="list">
      
        <h2>
          
          Key concepts
          
        </h2>
        <ul class="menu-root">
  
    
    
    
    <li>
      <a href="/documentation/v1/concepts/index.html" class="sidebar-link">Introduction</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/concepts/model-with-machines.html" class="sidebar-link current">Implementing UIs with state machines</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>



<div class="content concepts with-sidebar ">
  
    
    
  
  
    <h1>Implementing UIs with state machines</h1>
  
  
    <p>In this section, we make the link between reactive systems, behavior, state machines, and Kingly. We however strive to remain concise. You can alternatively review previously published long-form articles that, while gentle, go more in-depth:</p>
<ul>
<li><a href="https://medium.com/dailyjs/user-interfaces-you-can-trust-with-state-machines-49de7fa138a6" target="_blank" rel="noopener">User Interfaces You Can Trust with State Machines</a> </li>
<li><a href="http://brucou.github.io/documentation/v1/contributed/User%20interfaces%20as%20reactive%20systems.html">User interfaces as reactive systems</a></li>
</ul>
<p>Implementing an application with state machines consists of two steps: </p>
<ul>
<li>implementing the behavior of the application; and </li>
<li>implementing the actual application (with its user interface and all else). </li>
</ul>
<p>The application behavior is simply the relation between events received by the interface and commands to perform on the interfaced systems. Implementing the actual application includes performing the commands on the interfaced systems and creating listeners for the events accepted by the UI.</p>
<h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><p>Kingly is thus designed to encourage a UI implementation consisting of three separate modules with separate concerns:</p>
<p><img src="../../graphs/high%20level%20architecture%20ui%20implementation%20with%20kingly.jpg" alt="kingly-favoured ui architecture"></p>
<p>The interfaced systems — that includes the input device (e.g. your laptop or mobile phone), send events to the Kingly machine. The machine computes commands which are executed by command handlers. Those commands may result in API calls on the interfaced systems, whose responses may be processed by the command handler module, which in turn decides whether to send an event back to the machine for processing. Note that the output device — typically a screen, is but one of the interfaced systems, and the operation of rendering is but a command to the interfaced output device.</p>
<h2 id="Modeling-behavior"><a href="#Modeling-behavior" class="headerlink" title="Modeling behavior"></a>Modeling behavior</h2><p>A user interface can be specified by a relation between events received by the user interfaces and actions to be performed as a result on the interfaced system. With Kingly, you are expressing this relation with a procedure <code>fsm</code> which takes an event received by the interface into commands to perform on the interfaced systems: <code>commands = fsm(event)</code>. </p>
<p>In most of the cases, the same event may result in different commands to be executed. This means that the <code>fsm</code> procedure is a stateful one. A Kingly state machine is such a function, which <strong>encapsulates</strong> the necessary state so that it is only accessible and visible to the <code>fsm</code> function itself. If we make the encapsulated state visible, we can define a pure function $g$ such that  $(actions_n, state_{n+1}) = g (state_n, event_n)$, where $n$ is the $n^{th}$ invocation of the <code>fsm</code>  function for the $n^{th}$ input it processes.</p>
<p>Additionally, a Kingly state machine divides its encapsulated state in two kinds of state: control states, and extended state. The machine starts in an initial control state. For each control state, the state machine must define a sub-procedure <code>fsm&#39;</code> which will:</p>
<ul>
<li>perform the computation of commands when the machine is in that control state (i.e. <code>fsm(event) = fsm&#39;(event)</code>)</li>
<li>update its control state (we say that the machine <em>transitions</em> to its new control state) if some conditions are fulfilled (we call such conditions <em>guards</em>)</li>
<li>update its extended state</li>
</ul>
<p>Control states thus define a ‘formula’ computing the commands, while the extended state gathers the data necessary to perform the computation. As the machine changes of control state, the computation to perform changes accordingly. Control states may for instance serve to model interfaces going through different screens, associating a different relation between events and commands (i.e. behavior) to each screen.</p>
<p>State machines can be visually represented by a graph that links two control states whenever there is a possible transition between the two control states. The visualized graph summarizes accurately the <code>fsm</code> computation, i.e. the behavior of the interface to implement. </p>
<p>Modeling an interface behavior with state machines has the following advantages:</p>
<ul>
<li>the machine visualization is an accurate specification of the interface behavior;</li>
<li>the machine visualization can be used to communicate the behavior to programmers and non-programmers alike, including designers, project managers, and other project stakeholders; and</li>
<li>the state machine can be <em>compiled</em> to a standard JavaScript function that implements the interface behavior.</li>
</ul>
<p>Using Kingly as a state machine library has the following advantages:</p>
<ul>
<li>the behavior of the machine, i.e. the computation of commands to perform, is completely separated from the execution of those commands. This means that any rendering library can be used to display the user interface, <strong>without any modification of the machine implementation</strong>.</li>
<li>a Kingly machine is a standard JavaScript function that performs no effects. This means it is easy to test, without resorting to mocking, with any testing library of your choice.</li>
<li>test input sequences for the machine can additionally be automatically computed.</li>
<li>the interface behavior being separated from other concerns; it can be reused and shared among projects (for example on <code>npm</code>). </li>
</ul>
<h2 id="Application-implementation"><a href="#Application-implementation" class="headerlink" title="Application implementation"></a>Application implementation</h2><p>A possible workflow consists of the following steps:</p>
<ul>
<li>get a refined understanding of the interface behavior from its informal specifications;</li>
<li>define the user interface’s interface (i.e. <em>props</em> interface, and dispatched events);</li>
<li>implement and test the user interface;</li>
<li>define the command module interface (i.e. which commands are triggered by the user, the shape of those commands, and which events they produce as a result of their execution);</li>
<li>implement and test the command module;</li>
<li>modelize the interface behavior with a graph editor (I recommend <a href="https://www.yworks.com/downloads#yEd" target="_blank" rel="noopener">yed</a>);</li>
<li>write some tests (with at least all-transitions coverage of the modelized machine);</li>
<li>write the definition of the machine (i.e. initial state, events, transitions, guards, action factories) and pass the previous tests;</li>
<li>write and pass a few integration tests (all-states coverage may suffice if high confidence derived from unit tests); and</li>
<li>fully test the machine with automatically generated tests.</li>
</ul>
<p>We will address automated test generation in a <a href="../testing/">future dedicated section</a>. </p>

  
  
    <div class="next-links">
      
      
        <span>← <a href="/documentation/v1/concepts/index.html">Introduction</a></span>
      
      
      
    </div>
  
  <div class="footer">
    Caught a mistake?
    <a href="https://github.com/brucou/kingly-site/tree/master/src/v1/concepts/model-with-machines.md" rel="noopener" target="_blank">
            Edit this on GitHub!
    </a><br>
    Can we help you?     <a href="https://github.com/brucou/kingly/issues/new" rel="noopener" target="_blank">
      Let us know!
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
</html>
