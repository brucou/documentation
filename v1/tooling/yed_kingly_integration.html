

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>Integration with Kingly — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Integration with Kingly — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Integration with Kingly — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">    <div id="mobile-bar">
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link current">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link current">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

    </ul>
    <div class="list">
      
        <h2>
          
          
          
            <select class="version-select">
              <option value="SELF" selected>1.0</option>
            </select>
          
        </h2>
        <ul class="menu-root">
  
    
    
    
      
      
    
    <li>
      <a href="/documentation/v1/tooling/index.html" class="sidebar-link">Overview</a>
    </li>
  
    
    
    
      
      
      
    
    <li>
      <a href="/documentation/v1/tooling/graph_editing.html" class="sidebar-link">Graph editor</a>
    </li>
  
    
    
    
      
      
    
    <li>
      <a href="/documentation/v1/tooling/yed_kingly_integration.html" class="sidebar-link current">Integration with Kingly</a>
    </li>
  
    
    
    
      
      
      
    
    <li>
      <a href="/documentation/v1/tooling/compiling.html" class="sidebar-link new">Compiler</a>
    </li>
  
    
    
    
      
      
    
    <li>
      <a href="/documentation/v1/tooling/devtool.html" class="sidebar-link new">Dev tool</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>



<div class="content tooling with-sidebar ">
  
    
    
  
  
    <h1>Integration with Kingly</h1>
  
  
    <p>You want to use yEd to create Kingly state machines. You do. As simple and minimal as Kingly API strives to be, crafting and maintaining a large state machine by hand can involve repetitive tasks, tasks that a textual encoding supports poorly (e.g., refactoring transitions). Modeling is an iterative process and you want fast iterations. You want tooling that supports that. So what tools do you have at your disposal?</p>
<p>You have a professional, intuitive graph editor. You can model state machines by drawing them in that editor. When done, you save the graph in the native yEd <code>.graphml</code> format. To turn the drawing into an actual machine that you can run in a program, you then have two options:</p>
<ul>
<li>use the <code>yed2kingly</code> CLI; or</li>
<li>use the <code>slim</code> CLI`. </li>
</ul>
<p>Why two separate CLIs? What are the differences between the two? <code>yed2kingly</code> fits well with development workflows; produce files that are easier to debug; and allows using the Kingly’s devtool extension. On the other hand, the <code>slim</code> command has optimizations that make it more fit to production; it produces file with a smaller size (most machines you will write will fit between 0.5 and 2.5KB). Both CLIs will produce JavaScript files that can be imported/required by other modules of the application. Those files export factories that create Kingly machines.</p>
<p>This section will focus on the <code>yed2kingly</code> command. We start by reviewing in detail the end-to-end implementation workflow that the command supports. We then explain how to install and use the CLI.</p>
<h2 id="From-a-drawing-to-a-programming-function"><a href="#From-a-drawing-to-a-programming-function" class="headerlink" title="From a drawing to a programming function"></a>From a drawing to a programming function</h2><p>A Kingly state machine computes outputs as a result of being passed an input —- we will sometimes say that the machine processes or receives an event. The high-level specifications of the machine computation can be represented with a graph. Nodes in the graph correspond to control states of the machine. Edges connecting two nodes represent transitions between control states of the machine.</p>
<p>We said specifications because the drawing let us know how the machine will compute in response to an input depending on the state it is in. We said high-level specifications because the drawing does not allow the actual computing of a machine response —- it is a drawing. Let’s look at a <a href="https://brucou.github.io/documentation/v1/tutorials/counter-application.html">simple such drawing from the tutorials</a>:</p>
<p><img src="https://brucou.github.io/documentation/graphs/trivial%20counter%20machine.png" alt="simple machine"></p>
<p>This <strong>machine drawing</strong> tells us that when processing a <em>click</em> input, the modelized <strong>JavaScript machine</strong> should trigger the incrementing of a counter, and some rendering. It does not tell us how exactly that works. To turn the drawing into an actual JavaScript function, you need to provide the missing JavaScript objects: </p>
<ul>
<li>implementation of <em>increment counter</em>; and</li>
<li>implementation of <em>render</em>.</li>
</ul>
<p>The <code>.graphml</code> file contains the following pieces of information:</p>
<ul>
<li>the inputs (events) that are accepted by the machine;</li>
<li>the machine’s initial control state;</li>
<li>the control states of the machine;</li>
<li>the hierarchy of the machine; and</li>
<li>the transitions of the machines.</li>
</ul>
<p>The <code>yed2kingly</code> CLI extracts the pieces of information contained in the <code>.graphml</code> file that it receives as a parameter and produces two almost identical JavaScript files. One is destined to be used in a browser context (<code>.js</code> file), the other in a Node.js context (<code>.cjs</code> file that can be <code>require</code>d but not <code>import</code>ed).</p>
<p>The produced JavaScript files import/require the Kingly library, and export a machine factory that can be used by other modules to construct the actual JavaScript machine we seek. The machine factory must be passed as parameters the following pieces of information that are missing from the graph:</p>
<ul>
<li>the machine’s initial extended state;</li>
<li>the implementation for the machine guards, if any —- we only have their names;</li>
<li>the implementation for the machine actions, if any —- we only have their names;</li>
<li>the implementation of how the machine updates its internal state (<code>updateState</code> parameter); and</li>
<li>machine’s extra configuration —- e.g., debugging, tracing, dependency injection.</li>
</ul>
<p>You are invited to review the <a href="https://brucou.github.io/documentation/v1/tutorials/password-meter-using-graph-editor.html"><em>Password meter</em> tutorial</a> for a guided example of turning a machine drawing into a JavaScript machine with <code>yed2kingly</code>.</p>
<h2 id="Get-started"><a href="#Get-started" class="headerlink" title="Get started"></a>Get started</h2><p>If you haven’t yet installed the <code>yEd</code> editor, please do so by following the instructions <a href="https://brucou.github.io/documentation/v1/tooling/graph_editing.html">here</a>.</p>
<p>To use  <code>yed2kingly</code>  in the shell terminal, you will need to install the package globally:</p>
<pre><code class="hljs bash">npm install -g yed2kingly</code></pre>
<h2 id="How-does-it-work"><a href="#How-does-it-work" class="headerlink" title="How does it work?"></a>How does it work?</h2><p>In a typical process, I start designing a machine from the specifications by drawing it in the yEd editor. When I am done or ready to test the results of my design, I save the file. yEd by default saves its files in a <code>.graphml</code> format. I save the graphml file in the same directory in which I want to use the created state machine. From there, a previously launched watcher runs the <code>yed2kingly</code> node script on the newly saved file and generates a JavaScript file that exports the events, state hierarchy, and transitions contained in the graph — you can of course also run the script manually instead of using a watcher. The provided <code>exports</code> can then be used as parameters to create a Kingly state machine.</p>
<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><p><code>npm install -g yed2kingly</code></p>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><pre><code class="hljs bash">yed2kingly file.graphml</code></pre>
<p>Running the converter produces two files, targeted at consumption in a browser and node.js environment:</p>
<p>Before:<br><pre><code class="hljs bash">src/graphs/file.graphml</code></pre></p>
<p>After:<br><pre><code class="hljs bash">src/graphs/file.graphml.fsm.js
src/graphs/file.graphml.fsm.cjs</code></pre></p>
<p>The converter must emit an error or exit with an error code if the converted graph will not give rise to a valid Kingly machine (in particular cf. rules). The idea is to fail as early as possible.</p>
<p>The produced file export three objects: the events, state hierarchy and a transition factory. The first two objects can be used directly as parameters to create a Kingly machine, i.e. they follow the Kingly format. The transition factory requires the developer to associate a JavaScript function with any action and guard labels that are in the graph. The developer thus passed an object containing this information and is returned a Kingly <code>transitions</code> object. I provide an example which should clarify the expected syntax and usage.  </p>
<h3 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h3><p>Some definitions:</p>
<ul>
<li>An initial transition is that which originates from a node whose label is <code>init</code></li>
<li>A top-level initial transition is that initial transition which does not have any parent node</li>
<li>A history pseudo-state is a node whose label is H (shallow history) or H* (deep history)</li>
<li>A compound node is a node that is created in the yEd interface by using the group functionality (<em>Grouping &gt; Group</em> or <em>Ctrl-Alt-G</em> in version 3.19).</li>
</ul>
<ul>
<li>yed2kingly rules:<ul>
<li>With the exception of history and init pseudo-states, all nodes are converted to Kingly states</li>
<li>The Kingly name for a compound state will be the label displayed in the yEd editor for the matching group nodes in a non-collapsed state. This is important as yEd has another name for group nodes in the collapsed state.</li>
<li>The label for any edge in the graph maps to a Kingly transition record. The chosen syntax is <code>event [guard] / action</code>. Anyone of the event, guard, and action can be empty. Hence <code>[]/</code> is a valid syntax though not recommended.</li>
<li>There cannot be an action in the (unique by construction) top-level initial transition. There may be guards.</li>
<li>Labels <strong>must not</strong> include the reserved character <code>ღ</code></li>
<li>you can use the exact same label for different nodes (I do so in some of the tests), however, beware that this may come and bite you when you are tracing or debugging</li>
<li>The action label cannot be the reserved label <code>ACTION_IDENTITY</code></li>
<li>A label <code>x</code> must be so that the following JavaScript <code>{[x]: value}</code> is valid syntactically. This means labels can have spaces and a large set of Unicode characters, as allowed by the JavaScript specifications. Action labels such as <em>do this, do that</em> are thus valid.</li>
<li>edge labels (which contain the event/guard/action triple under the following syntax <code>event [guard] / action (comment)</code>) are parsed with an <a href="https://github.com/brucou/slim/blob/master/yedEdgeLabelGrammar.ne" target="_blank" rel="noopener">EBNF grammar</a>. As of June 2020, to avoid having to handle an ambiguous grammar:<ul>
<li><code>event</code> cannot have the characters <code>[</code>, <code>]</code>, <code>/</code>, <code>,</code> and <code>|</code> </li>
<li><code>guard</code> cannot have the characters <code>[</code>, <code>]</code>, and <code>,</code></li>
<li><code>actions</code> cannot have the characters <code>[</code>, <code>]</code>, <code>/</code>, <code>,</code> <code>(</code>, <code>)</code>, and <code>|</code></li>
</ul>
</li>
<li>an edge label may encode several transitions, separated by <code>|</code>. All rules above apply to each of the transition as if it was alone</li>
<li>edge labels can encode multiple transitions, provided those transitions encoding are separated by the <code>|</code> (pipe) character:<ul>
<li>e.g. <code>| event1 [guard1] / action1 | event2 [guard2] / action2</code> encodes two transitions triggered respectively by <code>event1</code> and <code>event2</code></li>
</ul>
</li>
<li>edge labels also encode composite guards and composite actions. Composite guards and actions are comma-separated actions. <code>guard1, guard2</code> encodes a guard which will be satisfied only and only if both <code>guard1</code> and <code>guard2</code> are satisfied. Similarly, <code>action1, action2</code> encode two actions that will be composed to form a single action. The composed outputs are the concatenation of the outputs of each action, in the same order<ul>
<li>e.g. <code>event [cond1, cond2] / action1, action2 (comment)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>In short:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Edge label</th>
<th>Valid</th>
</tr>
</thead>
<tbody>
<tr>
<td>start / display initial screen</td>
<td>Yes</td>
</tr>
<tr>
<td>start / display / initial screen</td>
<td>No</td>
</tr>
<tr>
<td>typed [letters?] / display password</td>
<td>Yes</td>
</tr>
<tr>
<td>typed [!letters?] /</td>
<td>Yes</td>
</tr>
<tr>
<td>typed [!letters?]</td>
<td>Yes</td>
</tr>
<tr>
<td>[!letters?]</td>
<td>Yes</td>
</tr>
<tr>
<td>[!letters?] / display password</td>
<td>Yes</td>
</tr>
<tr>
<td>start</td>
<td>Yes</td>
</tr>
<tr>
<td>[]</td>
<td>Yes</td>
</tr>
<tr>
<td>/</td>
<td>Yes</td>
</tr>
<tr>
<td>[] /</td>
<td>Yes</td>
</tr>
<tr>
<td></td>
<td>Yes</td>
</tr>
<tr>
<td>/ display password</td>
<td>Yes</td>
</tr>
<tr>
<td>成為   [或不]   / 成為</td>
<td>Yes</td>
</tr>
<tr>
<td>である[またはない] /である</td>
<td>Yes</td>
</tr>
<tr>
<td>&#124; start / display initial screen &#124; reset / navigate back</td>
<td>Yes, parses two transitions</td>
</tr>
<tr>
<td>&#124; start [letters? &#124; ] / display initial screen &#124; reset / navigate back</td>
<td>No</td>
</tr>
<tr>
<td>&#124; start [visible?, letters?] / display initial screen, navigate back</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</div>
<p>We recommend using the pipe character <code>|</code> exclusively and only to separate transitions. We recommend the comma <code>,</code> character exclusively to separate the components of a composite guard or action.</p>
<h4 id="Language-support"><a href="#Language-support" class="headerlink" title="Language support"></a>Language support</h4><p>Unfortunately, as of today, only English and German are supported in the yed interface. However, all UTF-8 characters are accepted in the graphs that you can edit. The previous Chinese and Japanese characters have been copy/pasted into yed and are displayed fine. </p>
<p>There is however an old issue (dating from 2015) that seems to indicate that it may not be possible to write the characters from a Chinese/Japanese keyboard. Please open an issue in the GitHub directory if you encounter a problem.</p>
<p>Lastly, right-to-left, and vertical languages will not be displayed in the correct order. Shamefully, yed offers very little in terms of internationalization and localization.</p>
<h3 id="Conventions"><a href="#Conventions" class="headerlink" title="Conventions"></a>Conventions</h3><p>The following conventions are not rules and are not enforced in any way. They exist for practicality or readability purposes.</p>
<ul>
<li>Nodes for machine states have a rectangular shape</li>
<li>Init pseudo-states are represented by a small circle with a different color than regular nodes</li>
<li>Compound states (group nodes in yEd terminology) should also be displayed in a third color </li>
</ul>
<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><p>There are plenty of graph examples in the <a href="https://github.com/brucou/yed2kingly/tree/master/tests/graphs" target="_blank" rel="noopener">test directory</a>. An example, extracted from the tests directory and involving compound states and history pseudo-states is as follows:</p>
<p><img src="https://imgur.com/VjKaIkL.png" alt="example of yed graph with history pseudo-state and compound state"></p>
<p>Running the <code>yed2kingly</code> script produces the following JavaScript file:</p>
<pre><code class="hljs js"><span class="hljs-comment">// Copy-paste help</span>
<span class="hljs-comment">// For debugging purposes, functions should all have a name</span>
<span class="hljs-comment">// Using natural language sentences in the graph is valid</span>
<span class="hljs-comment">// However, you will have to find a valid JavaScript name for the matching function</span>
<span class="hljs-comment">// -----Guards------</span>
<span class="hljs-comment">// const guards = &#123;</span>
<span class="hljs-comment">// &#125;;</span>
<span class="hljs-comment">// -----Actions------</span>
<span class="hljs-comment">// const actions = &#123;</span>
<span class="hljs-comment">//   "logGroup1toH": function ()&#123;&#125;,,,</span>
<span class="hljs-comment">//   "logBtoC": function ()&#123;&#125;,,</span>
<span class="hljs-comment">//   "logBtoD": function ()&#123;&#125;,,</span>
<span class="hljs-comment">//   "logCtoD": function ()&#123;&#125;,,</span>
<span class="hljs-comment">//   "logGroup1toD": function ()&#123;&#125;,,</span>
<span class="hljs-comment">//   "logGroup1toC": function ()&#123;&#125;,,</span>
<span class="hljs-comment">//   "logDtoD": function ()&#123;&#125;,</span>
<span class="hljs-comment">// &#125;;</span>
<span class="hljs-comment">// ----------------</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contains</span>(<span class="hljs-params">as, bs</span>) </span>&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">as</span>.every(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>&#123;
    <span class="hljs-keyword">return</span> bs.indexOf(a) &gt; <span class="hljs-number">-1</span>;
  &#125;);
&#125;
<span class="hljs-keyword">var</span> NO_OUTPUT = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">var</span> NO_STATE_UPDATE = [];
<span class="hljs-keyword">var</span> events = [<span class="hljs-string">"event3"</span>, <span class="hljs-string">"event2"</span>, <span class="hljs-string">"event1"</span>];
<span class="hljs-keyword">var</span> states = &#123;
  n1ღE: <span class="hljs-string">""</span>,
  <span class="hljs-string">"n2ღGroup 1"</span>: &#123; <span class="hljs-string">"n2::n0ღB"</span>: <span class="hljs-string">""</span>, <span class="hljs-string">"n2::n1ღC"</span>: <span class="hljs-string">""</span>, <span class="hljs-string">"n2::n2ღGroup 1"</span>: &#123; <span class="hljs-string">"n2::n2::n0ღD"</span>: <span class="hljs-string">""</span>, <span class="hljs-string">"n2::n2::n2ღD"</span>: <span class="hljs-string">""</span> &#125; &#125;,
&#125;;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getKinglyTransitions</span>(<span class="hljs-params">record</span>) </span>&#123;
  <span class="hljs-keyword">var</span> aF = record.actionFactories;
  <span class="hljs-keyword">var</span> guards = record.guards;
  <span class="hljs-keyword">var</span> actionList = [
    <span class="hljs-string">"logGroup1toH"</span>,
    <span class="hljs-string">"ACTION_IDENTITY"</span>,
    <span class="hljs-string">"logBtoC"</span>,
    <span class="hljs-string">"logBtoD"</span>,
    <span class="hljs-string">"logCtoD"</span>,
    <span class="hljs-string">"logGroup1toD"</span>,
    <span class="hljs-string">"logGroup1toC"</span>,
    <span class="hljs-string">"logDtoD"</span>,
  ];
  <span class="hljs-keyword">var</span> predicateList = [];
  aF[<span class="hljs-string">"ACTION_IDENTITY"</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ACTION_IDENTITY</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">return</span> &#123;
      <span class="hljs-attr">outputs</span>: NO_OUTPUT,
      <span class="hljs-attr">updates</span>: NO_STATE_UPDATE,
    &#125;;
  &#125;;
  <span class="hljs-keyword">if</span> (!contains(actionList, <span class="hljs-built_in">Object</span>.keys(aF))) &#123;
    <span class="hljs-built_in">console</span>.error(&#123; <span class="hljs-attr">actionFactories</span>: <span class="hljs-built_in">Object</span>.keys(aF), actionList &#125;);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Some action are missing either in the graph, or in the action implementation object!"</span>);
  &#125;
  <span class="hljs-keyword">if</span> (!contains(predicateList, <span class="hljs-built_in">Object</span>.keys(guards))) &#123;
    <span class="hljs-built_in">console</span>.error(&#123; <span class="hljs-attr">guards</span>: <span class="hljs-built_in">Object</span>.keys(guards), predicateList &#125;);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Some guards are missing either in the graph, or in the guard implementation object!"</span>);
  &#125;
  <span class="hljs-keyword">const</span> transitions = [
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n2ღGroup 1"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"event3"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n1ღE"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"logGroup1toH"</span>] &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n1ღE"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">""</span>, <span class="hljs-attr">to</span>: &#123; <span class="hljs-attr">shallow</span>: <span class="hljs-string">"n2ღGroup 1"</span> &#125;, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"ACTION_IDENTITY"</span>] &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"nok"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"init"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n2::n0ღB"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"ACTION_IDENTITY"</span>] &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n2::n0ღB"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"event2"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n2::n1ღC"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"logBtoC"</span>] &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n2::n0ღB"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"event1"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n2::n2::n2ღD"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"logBtoD"</span>] &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n2::n1ღC"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">""</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n2::n2::n0ღD"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"logCtoD"</span>] &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n2::n2ღGroup 1"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"init"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n2::n2::n0ღD"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"logGroup1toD"</span>] &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n2ღGroup 1"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"init"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n2::n1ღC"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"logGroup1toC"</span>] &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n2::n2::n2ღD"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"event1"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n2::n2::n0ღD"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"logDtoD"</span>] &#125;,
  ];

  <span class="hljs-keyword">return</span> transitions;
&#125;

<span class="hljs-keyword">export</span> &#123; events, states, getKinglyTransitions &#125;;</code></pre>
<p>The exported events, states, getKinglyTransitions can then be used in a regular JavaScript file as follows:</p>
<pre><code class="lang-js">    import {createStateMachine} from &#39;kingly&#39;;
    import {events, states, getKinglyTransitions} from &#39;tests/graphs/hierarchy-history-H.graphml.fsm.js&#39;;
(...)

    const guards = {};
    const actionFactories = {
      logGroup1toC: (s, e, stg) =&gt; traceTransition(&#39;Group1 -&gt; C&#39;),
      logBtoC: (s, e, stg) =&gt; traceTransition(&#39;B -&gt; C&#39;),
      logBtoD: (s, e, stg) =&gt; traceTransition(&#39;B -&gt; D&#39;),
      logCtoD: (s, e, stg) =&gt; traceTransition(&#39;C -&gt; D&#39;),
      logDtoGroup1H: (s, e, stg) =&gt; traceTransition(&#39;D -&gt; Group1H&#39;),
    };
    const fsmDef = {
      // NOTE: updateState and initialExtendedState are provided by the user
      updateState,
      initialExtendedState,
      events,
      states,
      transitions: getKinglyTransitions({ actionFactories, guards }),
    };
    const fsm = createStateMachine(fsmDef, settings);
</code></pre>
<h3 id="Final-note"><a href="#Final-note" class="headerlink" title="Final note"></a>Final note</h3><p>This process was chosen after plenty of reflection of pondering over what was the best approach for this functionality. A Babel plugin or macro was a possibility but the level of complexity was much higher — both from a macro creator and a macro user perspective, and the predictable requirements in terms of maintenance were also appreciable. The retained solution is to produce the outputs of the file conversion in a separate, independent JavaScript file. There is thus no necessity to write proprietary JavaScript, it is programming as usual.</p>
<p>This is a first version based on personal usage. Comments and recommendations are welcome if you have them about a better way to handle the integration of a graph editor with Kingly JavaScript library. Feel free to open an issue.</p>

  
  
  <div class="footer">
    <a id="follow-button" class="btn" title="Kingly Github" href="https://github.com/brucou/kingly">
      <img class="github" src="/documentation/images/GitHub-Mark-32px.png" alt="github">
    </a>
    <a id="follow-button" class="btn" title="Follow Kingly on Twitter" href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fbrucou.github.io/documentation%2F&amp;ref_src=twsrc%5Etfw&amp;region=follow_link&amp;screen_name=bricoi1&amp;tw_p=followbutton">
      <img class="twitter" src="/documentation/images/icons8-twitter-48.png" alt="twitter">
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
</html>
