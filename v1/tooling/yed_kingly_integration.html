

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>Integration with Kingly — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Integration with Kingly — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Integration with Kingly — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">    <div id="mobile-bar">
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link current">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link current">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

    </ul>
    <div class="list">
      
        <h2>
          
          
          
            <select class="version-select">
              <option value="SELF" selected>1.0</option>
            </select>
          
        </h2>
        <ul class="menu-root">
  
    
    
    
      
      
    
    <li>
      <a href="/documentation/v1/tooling/tools_overview.html" class="sidebar-link">Overview</a>
    </li>
  
    
    
    
      
      
      
    
    <li>
      <a href="/documentation/v1/tooling/graph_editing.html" class="sidebar-link">Graph editor</a>
    </li>
  
    
    
    
      
      
    
    <li>
      <a href="/documentation/v1/tooling/yed_kingly_integration.html" class="sidebar-link current">Integration with Kingly</a>
    </li>
  
    
    
    
      
      
      
    
    <li>
      <a href="/documentation/v1/tooling/compiling.html" class="sidebar-link new">Compiler</a>
    </li>
  
    
    
    
      
      
    
    <li>
      <a href="/documentation/v1/tooling/devtool.html" class="sidebar-link new">Dev tool</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>



<div class="content tooling with-sidebar ">
  
    
    
  
  
    <h1>Integration with Kingly</h1>
  
  
    <p>For anything serious, you do want to use yEd to create Kingly state machines. As simple and minimal as Kingly API strives to be, crafting and maintaining a large state machine by hand can involve repetitive tasks, tasks that a textual encoding supports poorly (e.g., refactoring transitions). Modeling is an iterative process and you want fast iterations. You want tooling that supports that. So what tools do you have at your disposal?</p>
<p>You have a professional, intuitive graph editor. You can model state machines by drawing them in that editor. When done, you save the graph in the native yEd <code>.graphml</code> format. To turn the drawing into an actual machine that you can run in a program, you then have two options:</p>
<ul>
<li>use the <code>yed2kingly</code> CLI; or</li>
<li>use the <code>slim</code> CLI. </li>
</ul>
<p>Why two separate CLIs? How do they differ? <code>yed2kingly</code> fits well with development workflows; produces files that are easier to debug; and allows using the Kingly’s devtool extension. On the other hand, the <code>slim</code> command has optimizations that makes it more fit to production; it produces files with a smaller size (most machines you will write will fit between 0.5 and 2.5KB). Both CLIs will produce JavaScript files that can be imported/required by other modules of the application. Those files export factories that create Kingly machines.</p>
<p>This section will focus on the <code>yed2kingly</code> command. We start by reviewing in detail the end-to-end implementation workflow that the command supports. We then explain how to install and use the CLI.</p>
<h2 id="From-a-drawing-to-a-JavaScript-function"><a href="#From-a-drawing-to-a-JavaScript-function" class="headerlink" title="From a drawing to a JavaScript function"></a>From a drawing to a JavaScript function</h2><p>A Kingly state machine computes outputs as a result of being passed an input — we will often say that the machine processes or receives an event. The high-level specifications of the machine computation can be represented with a graph. Nodes in the graph correspond to control states of the machine. Edges connecting two nodes represent transitions between control states of the machine.</p>
<p>We said specifications because the drawing let us know how the machine will compute in response to an input depending on the state it is in. We said high-level specifications because the drawing does not allow the actual computing of a machine response — it is a drawing. Let’s look at a <a href="https://brucou.github.io/documentation/v1/tutorials/counter-application.html">simple such drawing from the tutorials</a>:</p>
<p><img src="https://brucou.github.io/documentation/graphs/trivial%20counter%20machine.png" alt="simple machine"></p>
<p>This <strong>machine drawing</strong> tells us that when processing a <em>click</em> input, the modeled <strong>JavaScript machine</strong> should trigger the incrementing of a counter, and some rendering. It does not tell us how exactly that works. To turn the drawing into an actual JavaScript function, you need to provide the missing JavaScript objects: </p>
<ul>
<li>implementation of <em>increment counter</em>; and</li>
<li>implementation of <em>render</em>.</li>
</ul>
<p>The <code>.graphml</code> file contains the following pieces of information:</p>
<ul>
<li>the inputs (events) that are accepted by the machine;</li>
<li>the machine’s initial control state;</li>
<li>the control states of the machine;</li>
<li>the hierarchy of the machine; and</li>
<li>the machine’s transitions.</li>
</ul>
<p>The <code>yed2kingly</code> CLI extracts the pieces of information contained in the <code>.graphml</code> file that it receives as a parameter and produces two almost identical JavaScript files. One is destined to be used in a browser context (<code>.js</code> file), the other in a Node.js context (<code>.cjs</code> file that can be <code>require</code>d but not <code>import</code>ed).</p>
<p>The produced JavaScript files import/require the Kingly library, and export a machine factory that can be used by other modules to construct the actual JavaScript machine we seek. The machine factory must be passed the following pieces of information that are missing from the graph:</p>
<ul>
<li>the machine’s initial extended state;</li>
<li>the implementation for the machine guards, if any — we only have their names;</li>
<li>the implementation for the machine actions, if any — we only have their names;</li>
<li>the implementation of how the machine updates its internal state (<code>updateState</code> parameter); and</li>
<li>the machine’s optional configuration — e.g., debugging, tracing, dependency injection.</li>
</ul>
<p>You are invited to review the <a href="https://brucou.github.io/documentation/v1/tutorials/password-meter-using-graph-editor.html"><em>Password meter</em> tutorial</a> for a guided example of turning a machine drawing into a JavaScript machine with <code>yed2kingly</code>.</p>
<h2 id="Get-started"><a href="#Get-started" class="headerlink" title="Get started"></a>Get started</h2><p>If you haven’t yet installed the <code>yEd</code> editor, please do so by following the instructions <a href="https://brucou.github.io/documentation/v1/tooling/graph_editing.html">here</a>.</p>
<p>To use  <code>yed2kingly</code>  in the shell terminal, you will need to install the package globally:</p>
<pre><code class="hljs bash">npm install -g yed2kingly</code></pre>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><pre><code class="hljs bash">yed2kingly filename.graphml</code></pre>
<p>Running the converter produces two files, targeted at consumption in a browser and Node.js environment. Assuming the file <code>src/graphs/file.graphml</code> is passed to <code>yed2kingly</code>, the following two files are created: <code>src/graphs/file.graphml.fsm.js</code>, and <code>src/graphs/file.graphml.fsm.cjs</code>.</p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><p>There are plenty of graph examples in the <a href="https://github.com/brucou/yed2kingly/tree/master/tests/graphs" target="_blank" rel="noopener">test directory</a>. One such example involving compound states and history pseudo-states is as follows:</p>
<p><img src="https://imgur.com/VjKaIkL.png" alt="example of yed graph with history pseudo-state and compound state"></p>
<p>Running the <code>yed2kingly</code> script produces a JavaScript file that exports a <code>createStateMachineFromGraph</code> machine factory:</p>
<pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; createStateMachine &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"kingly"</span>;

<span class="hljs-comment">// Copy-paste help</span>
<span class="hljs-comment">// For debugging purposes, guards and actions functions should all have a name</span>
<span class="hljs-comment">// Using natural language sentences for labels in the graph is valid</span>
<span class="hljs-comment">// guard and action functions name still follow JavaScript rules though</span>
<span class="hljs-comment">// -----Guards------</span>
<span class="hljs-comment">/**
 * @param &#123;E&#125; extendedState
 * @param &#123;D&#125; eventData
 * @param &#123;X&#125; settings
 * @returns Boolean
 */</span>
<span class="hljs-comment">// const guards = &#123;</span>
<span class="hljs-comment">//   "can move &amp;amp;&amp;amp; won": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "can move &amp;amp;&amp;amp; !won": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "white piece": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "black piece": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "&amp;gt;0 moves": function ()&#123;&#125;,</span>
<span class="hljs-comment">// &#125;;</span>
<span class="hljs-comment">// -----Actions------</span>
<span class="hljs-comment">/**
 * @param &#123;E&#125; extendedState
 * @param &#123;D&#125; eventData
 * @param &#123;X&#125; settings
 * @returns &#123;&#123;updates: U[], outputs: O[]&#125;&#125;
 * (such that updateState:: E -&gt; U[] -&gt; E)
 */</span>
<span class="hljs-comment">// const actions = &#123;</span>
<span class="hljs-comment">//   "update clock": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "cancel timer": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "Move": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "restart timer": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "Undo": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "reset and start clock": function ()&#123;&#125;,</span>
<span class="hljs-comment">// &#125;;</span>
<span class="hljs-comment">// ----------------</span>

...

var events = [<span class="hljs-string">"clock ticked"</span>, <span class="hljs-string">"paused"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-string">"resume"</span>, <span class="hljs-string">"Undo"</span>];

...

function createStateMachineFromGraph(fsmDefForCompile, settings) &#123;
  <span class="hljs-keyword">var</span> updateState = fsmDefForCompile.updateState;
  <span class="hljs-keyword">var</span> initialExtendedState = fsmDefForCompile.initialExtendedState;

  <span class="hljs-keyword">var</span> transitions = getKinglyTransitions(&#123;
    <span class="hljs-attr">actionFactories</span>: fsmDefForCompile.actionFactories,
    <span class="hljs-attr">guards</span>: fsmDefForCompile.guards,
  &#125;);

  <span class="hljs-keyword">var</span> fsm = createStateMachine(
    &#123;
      updateState,
      initialExtendedState,
      states,
      events,
      transitions,
    &#125;,
    settings
  );

  <span class="hljs-keyword">return</span> fsm;
&#125;

<span class="hljs-keyword">export</span> &#123; createStateMachineFromGraph, ... &#125;;</code></pre>
<p>The exported <code>createStateMachineFromGraph</code> factory can then be used in a regular JavaScript file as follows:</p>
<pre><code class="hljs js">    <span class="hljs-keyword">import</span> &#123;createStateMachineFromGraph&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'tests/graphs/hierarchy-history-H.graphml.fsm.js'</span>;
(...)

    <span class="hljs-keyword">const</span> guards = ...;
    <span class="hljs-keyword">const</span> actionFactories = &#123;
     <span class="hljs-string">"update clock"</span>: ...,
     <span class="hljs-string">"cancel timer"</span>: ...,
     <span class="hljs-string">"Move"</span>: ...,
     <span class="hljs-string">"restart timer"</span>: ...,
     <span class="hljs-string">"Undo"</span>: ...,
     <span class="hljs-string">"reset and start clock"</span>: ...,
    &#125;;
    <span class="hljs-keyword">const</span> fsmDef = &#123;
      <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> updateState and initialExtendedState are provided by the user</span>
      updateState,
      initialExtendedState,
      guards,
      actionFactories
    &#125;;
    <span class="hljs-keyword">const</span> fsm = createStateMachineFromGraph(fsmDef, settings);</code></pre>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><ul>
<li>You can use the shortened <code>y2k</code> instead of <code>yed2kingly</code>.</li>
<li>You can have a file watcher in development that automatically runs <code>yed2kingly</code> when a <code>.graphml</code> file changes. The script will thus run every time you save the graph that you are working on.</li>
<li><p>the produced files include commented pieces of code that you can copy paste to speed up your implementation and reduce the possibility of errors. For instance, in the previous example, you need to provide a map of action names to action factories. You can copy-paste, uncomment, and complete the following commented code:</p>
<pre><code class="hljs js"><span class="hljs-comment">// const actions = &#123;</span>
<span class="hljs-comment">//   "update clock": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "cancel timer": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "Move": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "restart timer": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "Undo": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "reset and start clock": function ()&#123;&#125;,</span>
<span class="hljs-comment">// &#125;;</span></code></pre>
</li>
<li><p>Preferably use named functions for any action factories and guards. You will get friendlier logs in the dev console.</p>
</li>
</ul>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><p>The script will exit with an error code whenever:</p>
<ul>
<li>there are syntax errors in the yEd graph (e.g., forbidden or ambiguous edge label syntax). You may want to review the <a href="http://localhost:4000/documentation/v1/tooling/graph_editing.html#Syntax-reference" target="_blank" rel="noopener">detailed syntax reference</a>. You can paste the <a href="https://github.com/brucou/slim/blob/master/yedEdgeLabelGrammar.ne" target="_blank" rel="noopener">grammar</a> in the <a href="https://omrelli.ug/nearley-playground/" target="_blank" rel="noopener">Nearley parser playground</a> and check your syntax.</li>
<li>there are semantic errors in the yEd graph. That means that your drawing is legit, but it does not map to a valid Kingly machine. This may happen when you break Kingly contracts, for instance, if you have two initial control states for the same compound state. You may want to review <a href="http://localhost:4000/documentation/v1/api/index.html#Contracts" target="_blank" rel="noopener">Kingly contracts</a>.</li>
<li>the script cannot parse the file. You may want to check that you wrote the filename correctly, that the file exists at the expected location, and that the file is a valid <code>.graphml</code> file by opening it in yEd.</li>
<li>there is a bug! In that case, please <a href="https://github.com/brucou/kingly/issues" target="_blank" rel="noopener">open an issue on Github</a>.</li>
</ul>
<h2 id="Feedback-welcome"><a href="#Feedback-welcome" class="headerlink" title="Feedback welcome!"></a>Feedback welcome!</h2><p>Kingly tooling exist to address pain points from real use cases, and drive your productivity up. Your feedback is welcome and may result in the improvement or extension of the existing set of tools. If there is anything you feel should be addressed and is not, or should be addressed differently, get in touch by <a href="https://github.com/brucou/kingly/issues" target="_blank" rel="noopener">opening an issue on Github</a>.</p>

  
  
  <div class="footer">
    Caught a mistake?
    <a href="https://github.com/brucou/documentation/tree/master/v1/tooling/yed_kingly_integration.html" rel="noopener" target="_blank">
      Edit this on GitHub!
    </a>
    <a id="follow-button" class="btn" title="Kingly Github" href="https://github.com/brucou/kingly">
      <img class="github" src="/documentation/images/GitHub-Mark-32px.png" alt="github">
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
</html>
