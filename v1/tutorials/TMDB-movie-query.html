

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>Movie querying — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Movie querying — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Movie querying — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="mobile-bar">
      <a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tutorials/" class="nav-link current">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link current">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tutorials/" class="nav-link current">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link current">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

    </ul>
    <div class="list">
      
        <h2>
          
          Tutorials
          
            <select class="version-select">
              <option value="SELF" selected>1.0</option>
            </select>
          
        </h2>
        <ul class="menu-root">
  
    
    
      
        <li><h3>Introduction</h3></li>
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/index.html" class="sidebar-link">Why Kingly</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/counter-application.html" class="sidebar-link">Counter application</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/installation.html" class="sidebar-link">Installation</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/model-with-machines.html" class="sidebar-link">Implementing UIs with state machines</a>
    </li>
  
    
    
      
      
        <li><h3>Password meter</h3></li>
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter.html" class="sidebar-link">Modelization</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-implementation.html" class="sidebar-link">Machine implementation</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-ui-implementation.html" class="sidebar-link">Interface implementation</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-learnt.html" class="sidebar-link">What we learnt</a>
    </li>
  
    
    
      
      
      
        <li><h3>Chess game</h3></li>
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/chess-game.html" class="sidebar-link">Two-player chess game</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/chess-game-evolved.html" class="sidebar-link">Chess game - adding features</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/chess-game-ultimate.html" class="sidebar-link">Chess game - more features</a>
    </li>
  
    
    
      
      
      
      
        <li><h3>Movie database interface</h3></li>
      
    
    <li>
      <a href="/documentation/v1/tutorials/tmdb-online-interface.html" class="sidebar-link">Specifications</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/TMDB-top-level.html" class="sidebar-link">Top level breakdown</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/tmdb-routing.html" class="sidebar-link">Routing</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/v1/tutorials/TMDB-movie-query.html" class="sidebar-link current">Movie querying</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/graphs/movie-search/TMDB-movie-query-and-detail.html" class="sidebar-link">Movie details</a>
    </li>
  
    
    
      
      
      
      
    
    <li>
      <a href="/documentation/graphs/movie-search/TMDB-lessons-learnt.html" class="sidebar-link">What we learnt</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>



<div class="content tutorials with-sidebar ">
  
    
    
  
  
    <h1>Movie querying</h1>
  
  
    <p>We have by now handled the initial routing event and the displaying of a loading screen and querying of the TMDB database. Let’s continue our mapping efforts as per specifications:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Event</th>
<th style="text-align:left">Commands</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>ROUTE_CHANGED</code></td>
<td style="text-align:left">None. We already handled routing.</td>
</tr>
<tr>
<td style="text-align:left"><code>QUERY_CHANGED</code></td>
<td style="text-align:left">We should display again a loading screen, query anew the database, and update the browser’s url</td>
</tr>
<tr>
<td style="text-align:left"><code>SEARCH_RESULTS_RECEIVED</code></td>
<td style="text-align:left">We should display those results. The small trap to avoid is not to display the wrong results. Because we may have several queries in-flight, we have to check that the results we received correspond to the latest query performed.</td>
</tr>
<tr>
<td style="text-align:left"><code>SEARCH_ERROR_RECEIVED</code></td>
<td style="text-align:left">We should display the error screen. As before, we may have several queries in-flight, we have to check that the error we received correspond to the latest query performed.</td>
</tr>
<tr>
<td style="text-align:left"><code>MOVIE_SELECTED</code></td>
<td style="text-align:left">We should query the database for the movie details but only if the event corresponds to an action the user can perform in the first place, i.e when movies have already been displayed.</td>
</tr>
<tr>
<td style="text-align:left"><code>MOVIE_DETAILS_DESELECTED</code></td>
<td style="text-align:left">We should display the results screen for the previous TMDB movies querying, but again only if the corresponding user action is possible. The user action is not possible when the movie details have not been displayed yet.</td>
</tr>
<tr>
<td style="text-align:left"><code>SEARCH_RESULTS_MOVIE_RECEIVED</code></td>
<td style="text-align:left">You should get the gist by now</td>
</tr>
<tr>
<td style="text-align:left"><code>SEARCH_ERROR_MOVIE_RECEIVED</code></td>
<td style="text-align:left">You should get the gist by now</td>
</tr>
</tbody>
</table>
</div>
<p>The first two events do not require anything special to handle. </p>
<p>For <code>SEARCH_RESULTS_RECEIVED</code> and <code>SEARCH_ERROR_RECEIVED</code>, we need to know which is the latest in-flight query. For the same event, we have two different possible set of commands: we have a piece of state! As we said before, that piece of state can be either in the form of control states or part of the extended state. If we created new control states to handle those events, the posterior computation would be quite similar. Extended state is a better choice here. A guard, appropriately called <code>isLatest</code>, will help handle the differentiated treatment.</p>
<p>On the other hand, the <code>MOVIE_SELECTED</code> event leads to two possible set of commands: we have a piece of state! Control state or extended state? If results are not displayed, there is no commands to execute and the subsequent behaviour of the interface on subsequent events do not change vs. before receiving the event. Conversely, if results are displayed, and the user triggers the event, the behaviour is significantly different: we must query anew the database, display a loading screen, and so on. Using control states is a better choice.</p>
<p>Cutting corners, and long story short, we eventually reach the following modelization:</p>
<label for="mn-demo-6" class="margin-toggle">⊕</label><input type="checkbox" id="mn-demo-6" class="margin-toggle"><span class="marginnote"><p>Note that we no longer have <code>shouldProcess</code> guards as the new control states contains the information we need to decide on the control flow.</p>
</span>
<p><img src="../../graphs/movie-search/TMDB%20routing%20and%20movie%20querying.png" alt="TMDB with routing"></p>
<p><strong>TODO</strong> show a part of the change of the code with lots of ellipsis </p>
<p>Review the modelization and check we are indeed fulfilling additional portions of our specifications related to reaching the screen displaying the details of a specific movie. </p>
<p>Let’s finalize our refinement process.</p>

  
  
    <div class="next-links">
      
      
        <span>← <a href="/documentation/v1/tutorials/tmdb-routing.html">Routing</a></span>
      
      
      
        <span style="float: right;"><a href="/documentation/graphs/movie-search/TMDB-movie-query-and-detail.html">Movie details</a> →</span>
      
    </div>
  
  <div class="footer">
    <a id="follow-button" class="btn" title="Kingly Github" href="https://github.com/brucou/kingly">
      <img class="github" src="/documentation/images/GitHub-Mark-32px.png" alt="github">
    </a>
    <a id="follow-button" class="btn" title="Follow Kingly on Twitter" href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fbrucou.github.io/documentation%2F&amp;ref_src=twsrc%5Etfw&amp;region=follow_link&amp;screen_name=bricoi1&amp;tw_p=followbutton">
      <img class="twitter" src="/documentation/images/icons8-twitter-48.png" alt="twitter">
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
