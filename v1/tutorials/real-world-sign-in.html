

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>Sign-in route — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Sign-in route — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Sign-in route — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">    <div id="mobile-bar">
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link current">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Blog</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link current">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Blog</a>
</li>

    </ul>
    <div class="list">
      
        <h2>
          
          Tutorials
          
            <select class="version-select">
              <option value="SELF" selected>1.0</option>
            </select>
          
        </h2>
        <ul class="menu-root">
  
    
    
      
        <li><h3>Introduction</h3></li>
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/index.html" class="sidebar-link">Why Kingly</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/installation.html" class="sidebar-link">Get started</a>
    </li>
  
    
    
      
      
        <li><h3>Counter</h3></li>
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/counter-application.html" class="sidebar-link">Implementation</a>
    </li>
  
    
    
      
      
      
        <li><h3>Password meter</h3></li>
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter.html" class="sidebar-link">Modelization</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-implementation.html" class="sidebar-link">Machine implementation</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-ui-implementation.html" class="sidebar-link">Interface implementation</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-using-graph-editor.html" class="sidebar-link new">Implementation with the yEd graph editor</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-compiling.html" class="sidebar-link new">Compiling the machine</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-learnt.html" class="sidebar-link">What we learned</a>
    </li>
  
    
    
      
      
      
      
        <li><h3>Chess game</h3></li>
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/chess-game.html" class="sidebar-link">Two-player chess game</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/chess-game-evolved.html" class="sidebar-link">Chess game - adding features</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/chess-game-ultimate.html" class="sidebar-link">Chess game - more features</a>
    </li>
  
    
    
      
      
      
      
      
      
        <li><h3 class="new">RealWorld clone</h3></li>
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world.html" class="sidebar-link">RealWorld app</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-home.html" class="sidebar-link">Home route</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-sign-up.html" class="sidebar-link">Sign-up route</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-sign-in.html" class="sidebar-link current">Sign-in route</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-editor.html" class="sidebar-link">Editor route</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-settings.html" class="sidebar-link">Settings route</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-profile.html" class="sidebar-link">User profile route</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-article.html" class="sidebar-link">Article route</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-refactoring.html" class="sidebar-link">Refactoring</a>
    </li>
  
    
    
      
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-lessons-learnt.html" class="sidebar-link">Lessons learned</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>



<div class="content tutorials with-sidebar ">
  
    
    
  
  
    <h1>Sign-in route</h1>
  
  
    <p>In this section, we will modelize and implement the user flows related to the sign in route. In the <em>sign-in</em> route, the user logs in with his email and password. The following rules apply:</p>
<ul>
<li>authenticated users navigating to the <em>sign-in</em> page should be redirected to the <em>home</em> route</li>
<li>authenticated users cannot sign in while being logged in. Any attempt to do so will trigger a redirection to the <em>home</em> route </li>
</ul>
<p>The second rule is one that we added ourselves. The <a href="https://demo.realworld.io/#/" target="_blank" rel="noopener">demo app</a> actually lets you log in with two competing identities. I believe it is probably a bug. The reproducing sequence is as follows:</p>
<ul>
<li>open the login page in two separate tabs</li>
<li>log in with user 1 in the first tab</li>
<li>log in with user 2 in the second tab</li>
</ul>
<p>You should see in each tab the user feeds corresponding to each user. Further navigation however will use the latest logged in user as the current user, which is at best confusing, and in the worse case unsafe. In the context of this demo application, the impact is not huge, but we nonetheless insist here on taking a safer approach. </p>
<h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2><p>The screens for the <em>sign-in</em> route are similar to those of the <em>sign-up</em> screen with the difference that there is no <code>username</code> field in the <em>sign-in</em> page.</p>
<p>Implementation for the <code>src/UI/SignIn.svelte</code> component is similar to that of the <code>SignUp</code> component.</p>
<p>The <a href="https://github.com/brucou/realworld-kingly-svelte/blob/with-sign-in-route/src/UI/SignIn.svelte" target="_blank" rel="noopener">full source code</a> for the <code>SignIn</code> component can be accessed in the repository.</p>
<h2 id="UI-testing"><a href="#UI-testing" class="headerlink" title="UI testing"></a>UI testing</h2><p>As before, we test the UI with <a href="https://storybook.js.org/" target="_blank" rel="noopener">Storybook</a>. The <a href="https://github.com/brucou/realworld-kingly-svelte/blob/with-sign-in-route/stories/RealWorld.SignIn.stories.js" target="_blank" rel="noopener">corresponding stories</a> are available in the source repository.</p>
<h2 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h2><p>We have the following events for the <em>sign-in</em> route:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Event</th>
<th style="text-align:left">Event data</th>
<th style="text-align:left">Occurs when</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>CLICKED_SIGNIN</code></td>
<td style="text-align:left">form data (<code>{email, password}</code>)</td>
<td style="text-align:left">user submits the <em>sign-in</em> form</td>
</tr>
<tr>
<td style="text-align:left"><code>FAILED_SIGN_IN</code></td>
<td style="text-align:left">errors (as returned from the sign-in API)</td>
<td style="text-align:left">user submitted the <em>sign-in</em> form but the request failed</td>
</tr>
<tr>
<td style="text-align:left"><code>SUCCEEDED_SIGN_IN</code></td>
<td style="text-align:left">signed in user (as returned from the sign-in API)</td>
<td style="text-align:left">user submitted the <em>sign-in</em> form and the request succeeded</td>
</tr>
</tbody>
</table>
</div>
<p>Additionally, the user may click on links (like <em>have an account</em>). However, this is not handled directly by the machine. Instead, this is handled by the browser as any other links, triggering a change of URL, which then triggers a <em>ROUTE_CHANGED</em> event to the machine.</p>
<h2 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h2><p>We have the following commands for the <em>sign-in</em> route:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Command</th>
<th style="text-align:left">Command parameters</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>REDIRECT</code></td>
<td style="text-align:left">hash to redirect to</td>
<td style="text-align:left">redirects the user to a new/same hash location</td>
</tr>
<tr>
<td style="text-align:left"><code>SIGN_IN</code></td>
<td style="text-align:left">sign-in form data (<code>{email, password}</code>)</td>
<td style="text-align:left">sends an API request to sign the user in</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Commands-implementation"><a href="#Commands-implementation" class="headerlink" title="Commands implementation"></a>Commands implementation</h2><p>We already have implemented the <code>REDIRECT</code> command, so we will reuse that. </p>
<p>To implement the sign-in command, we again defer to the API and update the session repository with the new user data. The logic, as before, is enclosed into functions passed as effect handlers (<code>saveUser</code>, and <code>login</code>):</p>
<pre><code class="hljs javascript">[SIGN_IN]: <span class="hljs-function">(<span class="hljs-params">dispatch, params, effectHandlers</span>) =&gt;</span> &#123;
  <span class="hljs-keyword">const</span> &#123; email, password &#125; = params;
  <span class="hljs-keyword">const</span> &#123; login, saveUser &#125; = effectHandlers;

  login(&#123; email, password &#125;)
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;
      <span class="hljs-keyword">const</span> &#123; user &#125; = res;
      saveUser(user);
      dispatch(&#123; [SUCCEEDED_SIGN_IN]: user &#125;);
    &#125;)
    .catch(<span class="hljs-function">(<span class="hljs-params">&#123; errors &#125;</span>) =&gt;</span> &#123;
      dispatch(&#123; [FAILED_SIGN_IN]: errors &#125;);
    &#125;);
&#125;</code></pre>
<h2 id="User-scenarios-test"><a href="#User-scenarios-test" class="headerlink" title="User scenarios test"></a>User scenarios test</h2><p>We test four key user scenarios, the content of which should be clear from their identifiers in the code:</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> userStories = [
  [
    UNAUTH_USER_ON_SIGNIN_SEES_FORM,
    UNAUTH_USER_ON_SIGNIN_SEES_FORM_INPUTS,
    UNAUTH_USER_ON_SIGNIN_SEES_FORM_COMMANDS
  ],
  [
    AUTH_USER_ON_SIGNIN_IS_REDIRECTED,
    AUTH_USER_ON_SIGNIN_IS_REDIRECTED_INPUTS,
    AUTH_USER_ON_SIGNIN_IS_REDIRECTED_COMMANDS
  ],
  [
    UNAUTH_USER_ON_SIGNIN_SEES_FORM_SIGNS_IN_AND_SEES_HOME_FEED,
    UNAUTH_USER_ON_SIGNIN_SEES_FORM_SIGNS_IN_AND_SEES_HOME_FEED_INPUTS,
    UNAUTH_USER_ON_SIGNIN_SEES_FORM_SIGNS_IN_AND_SEES_HOME_FEED_COMMANDS
  ],
  [
    UNAUTH_USER_ON_SIGNIN_SEES_FORM_FAILS_SIGN_IN_AND_SEES_FORM_WITH_ERRORS,
    UNAUTH_USER_ON_SIGNIN_SEES_FORM_FAILS_SIGN_IN_AND_SEES_FORM_WITH_ERRORS_INPUTS,
    UNAUTH_USER_ON_SIGNIN_SEES_FORM_FAILS_SIGN_IN_AND_SEES_FORM_WITH_ERRORS_COMMANDS
  ]
];</code></pre>
<h2 id="Behaviour-modelization"><a href="#Behaviour-modelization" class="headerlink" title="Behaviour modelization"></a>Behaviour modelization</h2><p>The behaviour to modelize is very similar to that of the <em>sign up</em> route with the difference that there is no <em>username</em> field in the <em>sign-in</em> route. With that exception, the logic is the same and we reach the following modelization: </p>
<figure class="fullwidth"><p><img src="../../graphs/real-world/realworld-routing-signin.png" alt="realworld-home-tag-filter"></p>
</figure>
<p>Note that we do not need to guard against a user clicking the <em>sign-in</em> button twice, as, after the first click, the machine will be in another state which does not accept the second click! It is a good practice to also ensure that at the UI level by disabling the button when it is first clicked, but the state machine design already naturally covers that case. </p>
<p>Note also how we check twice that our user is authenticated before either displaying the sign-up form or executing the sign-up API request. Note also, how the nested structure of our state machine allows us to focus on the part that we are interested in visualizing, while folding the part we are not interested in.</p>
<p>More importantly, this <em>Sign-in route</em> sub-machine has the same structure as the <em>Sign-up route</em> sub-machine! That makes it a target candidate for refactoring. When it comes to DRY refactoring, we follow the <a href="https://blog.codinghorror.com/rule-of-three/" target="_blank" rel="noopener">rule of three</a>, i.e. we will wait for the third occurrence of a sub-machine with an identical structure before committing to defining a reusable abstraction.</p>
<h2 id="Behaviour-implementation"><a href="#Behaviour-implementation" class="headerlink" title="Behaviour implementation"></a>Behaviour implementation</h2><p>The <a href="https://github.com/brucou/realworld-kingly-svelte/blob/with-sign-in-route/src/behaviour/signIn.js" target="_blank" rel="noopener">implementation</a> (<code>src/behaviour/signIn.js</code>) derives directly from the modelization. </p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>We implemented the <em>sign-in</em> route for our application, following the <a href="/real-world.html#Implementation-strategy">implementation strategy</a> we previously detailed. The <em>sign-in</em> route behaviour was very similar to the <em>sign-up</em> route behaviour, and we have identified but delayed an opportunity to isolate the common behaviour in a refactoring.</p>

  
  
    <div class="next-links">
      
      
        <span>← <a href="/documentation/v1/tutorials/real-world-sign-up.html">Sign-up route</a></span>
      
      
      
        <span style="float: right;"><a href="/documentation/v1/tutorials/real-world-editor.html">Editor route</a> →</span>
      
    </div>
  
  <div class="footer">
    Caught a mistake?
    <a href="https://github.com/brucou/kingly-site/tree/master/src/v1/tutorials/real-world-sign-in.md" rel="noopener" target="_blank">
            Edit this on GitHub!
    </a><br>
    Can we help you?     <a href="https://github.com/brucou/kingly/discussions/new" rel="noopener" target="_blank">
      Let us know!
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
</html>
