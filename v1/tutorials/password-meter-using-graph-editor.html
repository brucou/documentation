

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>Implementation with the yEd graph editor — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Implementation with the yEd graph editor — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Implementation with the yEd graph editor — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">    <div id="mobile-bar">
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tutorials/" class="nav-link current">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tutorials/" class="nav-link current">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

    </ul>
    <div class="list">
      
        <h2>
          
          Tutorials
          
            <select class="version-select">
              <option value="SELF" selected>1.0</option>
            </select>
          
        </h2>
        <ul class="menu-root">
  
    
    
      
        <li><h3>Introduction</h3></li>
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/index.html" class="sidebar-link">Why Kingly</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/counter-application.html" class="sidebar-link">Counter application</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/installation.html" class="sidebar-link">Installation</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/model-with-machines.html" class="sidebar-link">Implementing UIs with state machines</a>
    </li>
  
    
    
      
      
        <li><h3>Password meter</h3></li>
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter.html" class="sidebar-link">Modelization</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-implementation.html" class="sidebar-link">Machine implementation</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-ui-implementation.html" class="sidebar-link">Interface implementation</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-using-graph-editor.html" class="sidebar-link current new">Implementation with the yEd graph editor</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/password-meter-learnt.html" class="sidebar-link">What we learnt</a>
    </li>
  
    
    
      
      
      
        <li><h3>Chess game</h3></li>
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/chess-game.html" class="sidebar-link">Two-player chess game</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/chess-game-evolved.html" class="sidebar-link">Chess game - adding features</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/chess-game-ultimate.html" class="sidebar-link">Chess game - more features</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/graphs/movie-search/TMDB-lessons-learnt.html" class="sidebar-link">What we learnt</a>
    </li>
  
    
    
      
      
      
      
      
        <li><h3 class="new">RealWorld clone</h3></li>
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world.html" class="sidebar-link">RealWorld app</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-home.html" class="sidebar-link">Home route</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-sign-up.html" class="sidebar-link">Sign up route</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-sign-in.html" class="sidebar-link">Sign in route</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-editor.html" class="sidebar-link">Editor route</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-settings.html" class="sidebar-link">Settings route</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-profile.html" class="sidebar-link">User profile route</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-article.html" class="sidebar-link">Article route</a>
    </li>
  
    
    
      
      
      
      
      
    
    
    <li>
      <a href="/documentation/v1/tutorials/real-world-lessons-learnt.html" class="sidebar-link">Lessons learnt</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>



<div class="content tutorials with-sidebar ">
  
    
    
  
  
    <h1>Implementation with the yEd graph editor</h1>
  
  
    <p>In the previous sections, we specified, designed, and implemented a password meter. In this section, we are going to reach the same implementation but this time, instead of writing the machine’s transitions manually, we are going to draw them in a graph editor, and convert the drawing to standard JavaScript. </p>
<p>This section aims at showcasing the yEd graph editor which the preferred tool to create and maintain Kingly state machines. yEd is simple to use, offer a series of automatic layouts, allow to zoom in and out of compound states, and can save the machine graph in a XML textual format which can be versioned on github.</p>
<h2 id="Install-yEd"><a href="#Install-yEd" class="headerlink" title="Install yEd"></a>Install yEd</h2><ul>
<li>Go to the <a href="https://www.yworks.com/products/yed" target="_blank" rel="noopener">yEd website</a></li>
<li>Download the desktop graph editor (click on <a href="https://www.yworks.com/products/yed/download#download" target="_blank" rel="noopener"><em>Download now</em></a>)<ul>
<li>you can alternatively try <a href="https://www.yworks.com/yed-live/" target="_blank" rel="noopener">yEd live</a> in the browser, but we recommend downloading the desktop version if you are going to draw more than one state machine </li>
</ul>
</li>
<li>run/install the downloaded executable</li>
</ul>
<h2 id="Creating-a-graph"><a href="#Creating-a-graph" class="headerlink" title="Creating a graph"></a>Creating a graph</h2><p>To make it easy to start drawing a graph representing a Kingly machine behavior, we recommend to open a template file that will contain the four elements that you will need in any graph:</p>
<p><img src="../../images/yed/template.png" alt="drawing template with basic elements"></p>
<p>The <a href="https://raw.githubusercontent.com/brucou/yed2Kingly/master/template.graphml" target="_blank" rel="noopener">template file can be downloaded</a> from GitHub.</p>
<p>Your editor should then look like this:</p>
<p><img src="../../images/yed/editor-with-template.gif" alt="editor with template file open"></p>
<p>yEd has many interesting options that we will explain later. For now, let’s reproduce the <a href="https://brucou.github.io/documentation/v1/tutorials/password-meter.html#Model">graph for our password meter</a>:</p>
<ul>
<li>open a new file (<em>File -&gt; New</em>)</li>
<li>save that file as password-meter (the editor will save the file as <code>password-meter.graphml</code>)</li>
</ul>
<p>We are now ready to edit:</p>
<ul>
<li>navigate to the previous tab (<code>template.graphml</code>) — you can use <kbd>Ctrl-Tab</kbd> to navigate the tabs in the editor</li>
<li>copy the init node (click on the init node then <kbd>Ctrl-C</kbd>)</li>
<li>navigate to the password meter tab and paste the init node (<kbd>Ctrl-V</kbd>)</li>
</ul>
<p>We have our initial pseudo-state! Let’s draw now the nodes:</p>
<ul>
<li>navigate back to the template tab</li>
<li>copy the yellow node</li>
<li>navigate to the password meter tab</li>
<li>paste the yellow node 4 times</li>
<li>update the labels for each of those three nodes to: <em>idle</em>, <em>weak</em>, <em>strong</em>, <em>done</em></li>
</ul>
<p>You should now have:</p>
<figure class="fullwidth"><p><img src="../../images/yed/password-meter-four-nodes-no-arrows.png" alt="editor with template file open"></p>
</figure>
<p>Let’s now do the edges:</p>
<ul>
<li>click on <em>init</em> node and drag to the <em>idle</em> node and let go. This should create an arrow between those two nodes</li>
<li>do the same between the <em>idle</em> aYou can have a look nd <em>weak</em> nodes</li>
<li>do the same between the <em>weak</em> and <em>strong</em> nodes</li>
<li>do the same between the <em>strong</em> and <em>weak</em> nodes</li>
<li>do the same between the <em>strong</em> and <em>done</em> nodes</li>
<li>do the same between the <em>strong</em> and <em>strong</em> nodes (a circle should appear as the origin and target node are the same)</li>
<li>do the same between the <em>weak</em> and <em>weak</em> nodes (a circle should appear as the origin and target node are the same)</li>
</ul>
<p>You can move nodes here and there to make space for you to drag the arrow.</p>
<p>Your graph at this moment is probably not well laid out. We are going to ask yEd to lay it out for us:</p>
<ul>
<li>Select the hierarchical layout (<em>Layout -&gt; Hierarchical</em> or <kbd>Alt-Shift-H</kbd>)</li>
<li>You will see a rich list of options that allows you to customize the layout, just click ok for now</li>
</ul>
<p>You should now see this:</p>
<figure class="fullwidth"><p><img src="../../images/yed/password-meter-four-nodes.png" alt="editor with template file open"></p>
</figure>
<p>Now let’s do the labels. The labels must follow the <code>event [guard] / action</code> format. Here, we are going again to copy from the <a href="https://brucou.github.io/documentation/v1/tutorials/password-meter.html#Model">already-made modelization</a>:</p>
<label for="mn-demo-20" class="margin-toggle">⊕</label><input type="checkbox" id="mn-demo-20" class="margin-toggle"><span class="marginnote"><p><code>\n</code> represents a new line and can be introduced by clicking <cmd>Shift-Enter</cmd></p>
</span>
<ul>
<li>the label between the <em>init</em> node and the <em>weak</em> node is <em>navigated to URL \n / display initial screen</em>. To insert a label, click on an edge, then press <kbd>F2</kbd>. A caret will appear, and you will be able to type a text</li>
<li>the label between the <em>weak</em> node and the <em>weak</em> node is <em>typed [!letter and numbers?] \n / display weak password screen</em></li>
<li>the label between the <em>strong</em> node and the <em>weak</em> node is also <em>typed [!letter and numbers?] \n / display weak password screen</em></li>
<li>the label between the <em>weak</em> node and the <em>strong</em> node is <em>typed [letter and numbers?] \n / display strong password screen</em></li>
<li>the label between the <em>strong</em> node and the <em>strong</em> node is also <em>typed [letter and numbers?] \n / display strong password screen</em></li>
<li>the label between the <em>strong</em> node and the <em>done</em> node is <em>clicked submit \n / display password submitted screen</em></li>
<li>apply the hierarchic layout again — this time, instead of clicking <em>Ok</em>, click on <em>Dock</em> — this will set a panel on the left side, with a play button. Click that play button to activate the hierarchic layout. Docking a layout is practical if you are going to use it several times.</li>
</ul>
<p>The result is not very readable:</p>
<figure class="fullwidth"><p><img src="../../images/yed/password-meter-four-nodes-with-arrows-and-labels.png" alt="editor with template file open"></p>
</figure>
<p>Let’s adjust the layout by modifying a setting:</p>
<ul>
<li>in the docked hierarchical layout panel, select <em>Edge labeling</em> in the <em>Labeling</em> section and set it to <code>Hierarchic</code></li>
<li>rerun the layout (play button)</li>
</ul>
<p>The layout reruns:</p>
<figure class="fullwidth"><p><img src="../../images/yed/password-meter-hierarchic-anim.apng" alt="editor with template file open"></p>
</figure>
<p>The final result is as follows:<br><figure class="fullwidth"><p><img src="../../images/yed/password-meter-hierarchic-done.png" alt="editor with template file open"></p>
</figure></p>
<p><strong>Et voila!</strong> With this, we have recreated the modelization for the password meter behaviour that we have shown in previous sections. We let yEd do the layout for us. Drawing a graph is as simple as copy-pasting-dragging nodes.</p>
<p>yEd has far more options that are very useful and other insightful layouts, but we will not introduce them at this stage of the tutorial.</p>
<p>Let’s now use our graph in order to create our machine in JavaScript.</p>
<h2 id="Converting-to-JavaScript"><a href="#Converting-to-JavaScript" class="headerlink" title="Converting to JavaScript"></a>Converting to JavaScript</h2><p>We now have a graph, but what we need is a machine that we can use from JavaScript (we often call that an executable version of the machine). To achieve that, we will now showcase the <code>yed2kingly</code> utility script. That script will take a <code>.graphml</code> file and turn into a JavaScript file that can be used to derive an executable state machine.</p>
<p>To do so:</p>
<ul>
<li><a href="https://brucou.github.io/documentation/v1/tooling/graph_editing.html#Install">install yed2kingly</a></li>
<li>go the directory where you saved the <code>password-meter.graphml</code> file</li>
<li>run <pre><code class="hljs bash">&gt; yed2kingly password-meter.graphml</code></pre>
</li>
</ul>
<p>This should create two files in the same directory:</p>
<ul>
<li><code>password-meter.graphml.fsm.js</code> (for consumption in browser environments) </li>
<li><code>password-meter.graphml.fsm.cjs</code> (for consumption in node environments)</li>
</ul>
<p>The <code>password-meter.graphml.fsm.js</code> is as follows:</p>
<pre><code class="hljs js"><span class="hljs-comment">// Copy-paste help</span>
<span class="hljs-comment">// For debugging purposes, guards and actions functions should all have a name</span>
<span class="hljs-comment">// Using natural language sentences for labels in the graph is valid</span>
<span class="hljs-comment">// guard and action functions name still follow JavaScript rules though</span>
<span class="hljs-comment">// -----Guards------</span>
<span class="hljs-comment">// const guards = &#123;</span>
<span class="hljs-comment">//   "!letter and numbers?": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "letter and numbers?": function ()&#123;&#125;,</span>
<span class="hljs-comment">// &#125;;</span>
<span class="hljs-comment">// -----Actions------</span>
<span class="hljs-comment">// const actions = &#123;</span>
<span class="hljs-comment">//   "display initial screen": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "display weak password screen": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "display strong password screen": function ()&#123;&#125;,</span>
<span class="hljs-comment">//   "display password submitted screen": function ()&#123;&#125;,</span>
<span class="hljs-comment">// &#125;;</span>
<span class="hljs-comment">// ----------------</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contains</span>(<span class="hljs-params">as, bs</span>) </span>&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">as</span>.every(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>&#123;
    <span class="hljs-keyword">return</span> bs.indexOf(a) &gt; <span class="hljs-number">-1</span>;
  &#125;);
&#125;
<span class="hljs-keyword">var</span> NO_OUTPUT = [];
<span class="hljs-keyword">var</span> NO_STATE_UPDATE = [];
<span class="hljs-keyword">var</span> events = [<span class="hljs-string">"start"</span>, <span class="hljs-string">"typed"</span>, <span class="hljs-string">"clicked submit"</span>];
<span class="hljs-keyword">var</span> states = &#123; n1ღdone: <span class="hljs-string">""</span>, n2ღstrong: <span class="hljs-string">""</span>, n3ღweak: <span class="hljs-string">""</span>, n4ღidle: <span class="hljs-string">""</span> &#125;;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getKinglyTransitions</span>(<span class="hljs-params">record</span>) </span>&#123;
  <span class="hljs-keyword">var</span> aF = record.actionFactories;
  <span class="hljs-keyword">var</span> guards = record.guards;
  <span class="hljs-keyword">var</span> actionList = [
    <span class="hljs-string">"display initial screen"</span>,
    <span class="hljs-string">"display weak password screen"</span>,
    <span class="hljs-string">"display strong password screen"</span>,
    <span class="hljs-string">"display password submitted screen"</span>,
    <span class="hljs-string">"ACTION_IDENTITY"</span>,
  ];
  <span class="hljs-keyword">var</span> predicateList = [<span class="hljs-string">"!letter and numbers?"</span>, <span class="hljs-string">"letter and numbers?"</span>];
  aF[<span class="hljs-string">"ACTION_IDENTITY"</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ACTION_IDENTITY</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">return</span> &#123;
      <span class="hljs-attr">outputs</span>: NO_OUTPUT,
      <span class="hljs-attr">updates</span>: NO_STATE_UPDATE,
    &#125;;
  &#125;;
  <span class="hljs-keyword">if</span> (!contains(actionList, <span class="hljs-built_in">Object</span>.keys(aF))) &#123;
    <span class="hljs-built_in">console</span>.error(&#123; <span class="hljs-attr">actionFactories</span>: <span class="hljs-built_in">Object</span>.keys(aF), actionList &#125;);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Some action are missing either in the graph, or in the action implementation object!"</span>);
  &#125;
  <span class="hljs-keyword">if</span> (!contains(predicateList, <span class="hljs-built_in">Object</span>.keys(guards))) &#123;
    <span class="hljs-built_in">console</span>.error(&#123; <span class="hljs-attr">guards</span>: <span class="hljs-built_in">Object</span>.keys(guards), predicateList &#125;);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Some guards are missing either in the graph, or in the guard implementation object!"</span>);
  &#125;
  <span class="hljs-keyword">const</span> transitions = [
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n4ღidle"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"start"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n3ღweak"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"display initial screen"</span>] &#125;,
    &#123;
      <span class="hljs-attr">from</span>: <span class="hljs-string">"n3ღweak"</span>,
      <span class="hljs-attr">event</span>: <span class="hljs-string">"typed"</span>,
      <span class="hljs-attr">guards</span>: [
        &#123; <span class="hljs-attr">predicate</span>: guards[<span class="hljs-string">"!letter and numbers?"</span>], <span class="hljs-attr">to</span>: <span class="hljs-string">"n3ღweak"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"display weak password screen"</span>] &#125;,
        &#123; <span class="hljs-attr">predicate</span>: guards[<span class="hljs-string">"letter and numbers?"</span>], <span class="hljs-attr">to</span>: <span class="hljs-string">"n2ღstrong"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"display strong password screen"</span>] &#125;,
      ],
    &#125;,
    &#123;
      <span class="hljs-attr">from</span>: <span class="hljs-string">"n2ღstrong"</span>,
      <span class="hljs-attr">event</span>: <span class="hljs-string">"typed"</span>,
      <span class="hljs-attr">guards</span>: [
        &#123; <span class="hljs-attr">predicate</span>: guards[<span class="hljs-string">"letter and numbers?"</span>], <span class="hljs-attr">to</span>: <span class="hljs-string">"n2ღstrong"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"display strong password screen"</span>] &#125;,
        &#123; <span class="hljs-attr">predicate</span>: guards[<span class="hljs-string">"!letter and numbers?"</span>], <span class="hljs-attr">to</span>: <span class="hljs-string">"n3ღweak"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"display weak password screen"</span>] &#125;,
      ],
    &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"n2ღstrong"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"clicked submit"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n1ღdone"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"display password submitted screen"</span>] &#125;,
    &#123; <span class="hljs-attr">from</span>: <span class="hljs-string">"nok"</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">"init"</span>, <span class="hljs-attr">to</span>: <span class="hljs-string">"n4ღidle"</span>, <span class="hljs-attr">action</span>: aF[<span class="hljs-string">"ACTION_IDENTITY"</span>] &#125;,
  ];

  <span class="hljs-keyword">return</span> transitions;
&#125;

<span class="hljs-keyword">export</span> &#123; events, states, getKinglyTransitions &#125;;</code></pre>
<p>From the previous code, we are going to use the exported variables to create the machine:</p>
<pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; NO_STATE_UPDATE, createStateMachine &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"kingly"</span>;
<span class="hljs-keyword">import</span> &#123; tracer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"courtesan"</span>;
<span class="hljs-keyword">import</span> &#123;
  events,
  states,
  getKinglyTransitions
&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"./password-meter.graphml.fsm"</span>;
    
<span class="hljs-comment">// -----Guards------</span>
<span class="hljs-keyword">const</span> guards = &#123;
  <span class="hljs-string">"!letter and numbers?"</span>: isPasswordWeak,
  <span class="hljs-string">"letter and numbers?"</span>: isPasswordStrong
&#125;;

<span class="hljs-comment">//-----Actions------</span>
<span class="hljs-keyword">const</span> actions = &#123;
  <span class="hljs-string">"display initial screen"</span>: displayInitScreen,
  <span class="hljs-string">"display weak password screen"</span>: displayInputInRed,
  <span class="hljs-string">"display strong password screen"</span>: displayInputInGreen,
  <span class="hljs-string">"display password submitted screen"</span>: displaySubmittedPassword
&#125;;

<span class="hljs-keyword">const</span> transitions = getKinglyTransitions(&#123; <span class="hljs-attr">actionFactories</span>: actions, guards &#125;);

<span class="hljs-keyword">const</span> pwdFsmDef = &#123;
  <span class="hljs-comment">// initialControlState,</span>
  initialExtendedState,
  states,
  events,
  transitions,
  updateState
&#125;;

<span class="hljs-built_in">window</span>.pwdFsm = createStateMachine(pwdFsmDef, &#123;
  <span class="hljs-attr">debug</span>: &#123; <span class="hljs-built_in">console</span> &#125;,
  <span class="hljs-attr">devTool</span>: &#123; tracer &#125;
&#125;);</code></pre>
<p>In this code, you can observe that:</p>
<ul>
<li>we reused the action factories and guards from the previous implementation. This is expected as we did not change anything in our specifications!</li>
<li>we however map the text that was entered in the yEd graph to the corresponding JavaScript code. Because our labels have the shape <code>event [guard] / action</code>, we need to map the text corresponding to <code>guard</code> to a JavaScript predicate function, and do the same for the text corresponding to <code>action</code>. You can thus use natural language in the yEd graph;</li>
<li>the transitions are computed with the <code>getKinglyTransitions</code> factory which takes as arguments the mapping we previously mentioned;</li>
<li>there is no longer an initial control state to pass: the transitions computed by <code>getKinglyTransitions</code> already include that information.</li>
</ul>
<p>You can have a look at the resulting reimplementation in the following playground:</p>
<iframe src="https://codesandbox.io/embed/fy5pc?fontsize=12&hidenavigation=1" title="Counter app" style="width:1000px; height:700px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<p>To check that nothing have changed vs. the previous implementation, we rerun the same command sequences in playground as before:</p>
<pre><code class="hljs bash">pwdFsm()
pwdFsm(&#123;&#125;)
pwdFsm(&#123;rqwe: 314&#125;)
pwdFsm(&#123;<span class="hljs-string">"start"</span>: void 0&#125;)
pwdFsm(&#123;<span class="hljs-string">"clicked submit"</span>:void 0&#125;)
pwdFsm(&#123;<span class="hljs-string">"clicked submit"</span>:void 0&#125;)
pwdFsm(&#123;<span class="hljs-string">"typed"</span>:<span class="hljs-string">'a'</span>&#125;)
pwdFsm(&#123;<span class="hljs-string">"clicked submit"</span>:void 0&#125;)
pwdFsm(&#123;<span class="hljs-string">"typed"</span>:<span class="hljs-string">'a2'</span>&#125;)
pwdFsm(&#123;<span class="hljs-string">"clicked submit"</span>:void 0&#125;)</code></pre>
<p>We can also check in the dev tool that we produce the same results, and that the machine ends in the <em>done</em> control state: </p>
<figure class="fullwidth"><p><img src="../../images/password-meter-devtool-playground.apng" alt="editor with template file open"></p>
</figure>
<p>Given that we reproduced the exact same Kingly machine, albeit from a yEd file, the rest of the user interface implementation for the password meter is <strong>exactly</strong> the same: you can reuse the previous view implementation with no changes.</p>
<p>This is it! We successfully modelized a password meter behaviour, we implemented that behaviour with a Kingly state machine by two methods: first, directly implementing the machine manually; second, using a professional graph editor with automatic layouting.</p>
<p>It is important that you review carefully what we have done here, as all the examples in this documentation are indeed produced with the yEd editor; and it is a great productivity saving tool. One best practice when it comes to state machine implementation is to modelize the machine first in a graph editor, not write code by hand. The automated tooling that Kingly provides ensures that there are no mistakes made when translating the graph into code. You can afterwards focus on implementing the guards and actions with JavaScript. If you configure a watcher to automatically convert <code>.graphml</code> files into JavaScript, this gives for a fairly smooth implementation process. The hardest part will always be to design the machine.</p>

  
  
    <div class="next-links">
      
      
        <span>← <a href="/documentation/v1/tutorials/password-meter-ui-implementation.html">Interface implementation</a></span>
      
      
      
        <span style="float: right;"><a href="/documentation/v1/tutorials/password-meter-learnt.html">What we learnt</a> →</span>
      
    </div>
  
  <div class="footer">
    <a id="follow-button" class="btn" title="Kingly Github" href="https://github.com/brucou/kingly">
      <img class="github" src="/documentation/images/GitHub-Mark-32px.png" alt="github">
    </a>
    <a id="follow-button" class="btn" title="Follow Kingly on Twitter" href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fbrucou.github.io/documentation%2F&amp;ref_src=twsrc%5Etfw&amp;region=follow_link&amp;screen_name=bricoi1&amp;tw_p=followbutton">
      <img class="twitter" src="/documentation/images/icons8-twitter-48.png" alt="twitter">
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
</html>
