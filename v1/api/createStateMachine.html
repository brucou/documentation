

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>createStateMachine — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="createStateMachine — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="createStateMachine — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">    <div id="mobile-bar">
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team current">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team current">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Contributed</a>
</li>

    </ul>
    <div class="list">
      
        <h2>
          
          API
          
            <select class="version-select">
              <option value="SELF" selected>1.0</option>
            </select>
          
        </h2>
        <ul class="menu-root">
  
    
    
    
    <li>
      <a href="/documentation/v1/api/index.html" class="sidebar-link">Overview</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/api/createStateMachine.html" class="sidebar-link current">createStateMachine</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/api/createPureStateMachine.html" class="sidebar-link">createPureStateMachine</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/api/makeWebComponent.html" class="sidebar-link">makeWebComponentFromFsm</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/api/terminology.html" class="sidebar-link">Terminology</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>



<div class="content api with-sidebar ">
  
    
    
  
  
    <h1>createStateMachine</h1>
  
  
    <p><code>createStateMachine :: FSM_Def -&gt; FSM_Settings -&gt; Stateful_FSM</code></p>
<h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>This FSM factory function takes the parameters defining the behavior of the state machine and returns the created state machine. The created state machine is a regular function called with inputs that are passed to the encapsulated state machine, which computes the function’s output. The syntax for an input is <code>{[eventLabel] : eventData}</code>, i.e. an input is an object with exactly one key, which is the event identifier, and the value matching the key is the event data.</p>
<p>The machine additionally may carry over environment variables, which are accessible in guards, and action factories. This helps to maintain such functions pure and testable. Environment variables can also be used to parameterize the state machine’s behavior.</p>
<p>History pseudo-states are generated by a helper function <code>historyState :: HistoryType -&gt; ControlState -&gt; HistoryPseudoState</code>. A history state is coupled to a compound control state and has a type (deep or shallow). Passing this information to the factory produces the sought history state. </p>
<p>The <code>settings.updateState</code> property is mandatory and specifies how to update a model from the <code>.updates</code> produced by an action factory. We used successfully <a href="http://jsonpatch.com/" target="_blank" rel="noopener">JSON patch</a> operations for model updates, but you can choose to use the immutable library of your choice or a simple reducer. The important point is that the extended state should not be modified in place, i.e. <code>updateState</code> is a pure function. </p>
<p>The <code>settings.debug.checkContracts</code>, when set, represents contracts that the state machine must fulfill. The <code>kingly</code> library comes by default with a set of contracts enforcing most of the syntax and semantics of the state machine format chosen.</p>
<p>The <code>settings.debug.console</code>, when set, represents a <code>console</code> object through which tracing and debug info will flow. This is useful in development and can be turned off in production.</p>
<h2 id="Contracts"><a href="#Contracts" class="headerlink" title="Contracts"></a>Contracts</h2><ul>
<li>All <a href="https://github.com/brucou/kingly#contracts" target="_blank" rel="noopener">previously mentioned</a> contracts apply.</li>
<li><a href="https://github.com/brucou/kingly/blob/master/src/types.js" target="_blank" rel="noopener">Type contracts</a></li>
<li>The <code>settings.updateState</code> property is mandatory!</li>
<li>The <code>settings</code> property <strong>should not be modified</strong> after being passed as parameter (i.e. should be a constant): it is not cloned and is passed to all relevant functions (guards, etc.)</li>
</ul>
<h2 id="Implementation-example"><a href="#Implementation-example" class="headerlink" title="Implementation example"></a>Implementation example</h2><p>We are going to show the definition for the following hierarchical state machine:</p>
<figure class="fullwidth"><p><img src="../../api-assets/history%20transitions,%20INIT%20event%20CASCADING%20transitions.png" alt="deep and shallow history"></p>
</figure>
<p>The definition is as follows:</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> states = &#123; [OUTER]: &#123; [INNER]: &#123; [INNER_S]: <span class="hljs-string">''</span>, [INNER_T]: <span class="hljs-string">''</span> &#125;, [OUTER_A]: <span class="hljs-string">''</span>, [OUTER_B]: <span class="hljs-string">''</span> &#125;, [Z]: <span class="hljs-string">''</span> &#125;;
  <span class="hljs-keyword">const</span> fsmDef = &#123;
    states,
    <span class="hljs-attr">events</span>: [EVENT1, EVENT2, EVENT3, EVENT4],
    <span class="hljs-attr">initialExtendedState</span>: &#123; <span class="hljs-attr">history</span>: SHALLOW, <span class="hljs-attr">counter</span>: <span class="hljs-number">0</span> &#125;,
    <span class="hljs-attr">transitions</span>: [
      &#123; <span class="hljs-attr">from</span>: INIT_STATE, <span class="hljs-attr">event</span>: INIT_EVENT, <span class="hljs-attr">to</span>: OUTER, <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
      &#123; <span class="hljs-attr">from</span>: OUTER, <span class="hljs-attr">event</span>: INIT_EVENT, <span class="hljs-attr">to</span>: OUTER_A, <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
      &#123; <span class="hljs-attr">from</span>: OUTER_A, <span class="hljs-attr">event</span>: EVENT1, <span class="hljs-attr">to</span>: INNER, <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
      &#123; <span class="hljs-attr">from</span>: INNER, <span class="hljs-attr">event</span>: INIT_EVENT, <span class="hljs-attr">to</span>: INNER_S, <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
      &#123; <span class="hljs-attr">from</span>: INNER_S, <span class="hljs-attr">event</span>: EVENT3, <span class="hljs-attr">to</span>: INNER_T, <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
      &#123; <span class="hljs-attr">from</span>: INNER_T, <span class="hljs-attr">event</span>: EVENT3, <span class="hljs-attr">to</span>: INNER_S, <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
      &#123; <span class="hljs-attr">from</span>: INNER, <span class="hljs-attr">event</span>: EVENT2, <span class="hljs-attr">to</span>: OUTER_B, <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
      &#123; <span class="hljs-attr">from</span>: OUTER, <span class="hljs-attr">event</span>: EVENT1, <span class="hljs-attr">to</span>: Z, <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
      &#123;
        <span class="hljs-attr">from</span>: Z, <span class="hljs-attr">event</span>: EVENT4, <span class="hljs-attr">guards</span>: [
          &#123;
            <span class="hljs-attr">predicate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isDeep</span>(<span class="hljs-params">x, e</span>) </span>&#123;<span class="hljs-keyword">return</span> x.history === DEEP&#125;,
            <span class="hljs-attr">to</span>: historyState(DEEP, OUTER),
            <span class="hljs-attr">action</span>: incCounter
          &#125;,
          &#123;
            <span class="hljs-attr">predicate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isShallow</span>(<span class="hljs-params">x, e</span>) </span>&#123;<span class="hljs-keyword">return</span> x.history !== DEEP&#125;,
            <span class="hljs-attr">to</span>: historyState(SHALLOW, OUTER),
            <span class="hljs-attr">action</span>: incCounter
          &#125;
        ]
      &#125;,
    ],
    <span class="hljs-attr">settings</span> : &#123; <span class="hljs-attr">updateState</span> : applyJSONpatch &#125;
  &#125;;</code></pre>
<p>Note in particular:</p>
<ul>
<li>the nesting of states in <code>states</code></li>
<li>the use of <code>ACTION_IDENTITY</code> when there is no action to be applied<ul>
<li>that action does not modify the extended state of the machine, and returns <code>NO_OUTPUT</code></li>
</ul>
</li>
<li>how history states are included in the machine definition with <code>historyState</code></li>
</ul>
<p>There are plenty of additional examples in the <a href="https://github.com/brucou/kingly/blob/master/test/hierarchy.specs.js" target="_blank" rel="noopener">test directory</a>.</p>

  
  
  <div class="footer">
    Caught a mistake?
    <a href="https://github.com/brucou/kingly-site/tree/master/v1/api/createStateMachine.html" rel="noopener" target="_blank">
      Edit this on GitHub!
    </a>
    <a id="follow-button" class="btn" title="Kingly Github" href="https://github.com/brucou/kingly">
      <img class="github" src="/documentation/images/GitHub-Mark-32px.png" alt="github">
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
</html>
