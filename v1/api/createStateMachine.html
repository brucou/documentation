

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>createStateMachine — Kingly.js</title>
  <meta charset="utf-8">
  <meta name="description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="createStateMachine — Kingly.js">
  <meta property="og:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta property="og:image" content="https://brucou.github.io/documentation//documentation/images/kingly_logo.png">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="createStateMachine — Kingly.js">
  <meta name="twitter:description" content="Kingly - The Modelling Library for Portable UIs">
  <meta name="twitter:image" content="https://brucou.github.io/documentation/images/kingly_logo.png">

  <link rel="apple-touch-icon" sizes="180x180" href="/documentation/images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/documentation/images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/documentation/images/icons/favicon-256x256.png">
  <link rel="icon" href="/documentation/images/kingly_logo.png" type="image/png">

  <link href="//fonts.googleapis.com/css?family=Lato:300,400,600" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Overlock:400&text=Kingly.js" rel="stylesheet" type="text/css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- main page styles -->
  <link rel="stylesheet" href="/documentation/css/page.css">

  <!--<script src="/documentation/js/kingly.js"></script>-->

  <!-- ga -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-141924019-1', 'brucou.github.io/documentation');
    ga('send', 'pageview');
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body class="docs">    <div id="mobile-bar">
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><a class="menu-button"></a>
      <a class="logo" href="/documentation"></a>
    </div>
    

<div id="header">
  <a id="logo" href="/documentation/">
    <img src="/documentation/images/kingly_logo.png" alt="library logo">
    <span>Kingly</span>
    
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team current">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Blog</a>
</li>

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/concepts/" class="nav-link">Concepts</a></li>
        <li><a href="/documentation/v1/tutorials/" class="nav-link">Tutorials</a></li>
        <li><a href="/documentation/v1/examples/" class="nav-link">Examples</a></li>
        <li><a href="/documentation/v1/cookbook/" class="nav-link">Cookbook</a></li>
        <li><a href="/documentation/v1/best-practices/" class="nav-link">Best practices</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/api/index.html" class="nav-link team current">API</a>
</li>
<li class="nav-dropdown-container tooling">
  <a class="nav-link">Tooling</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/tooling/tools_overview.html" class="nav-link">Overview</a></li>
        <li><a href="/documentation/v1/tooling/graph_editing.html" class="nav-link">Graph editing</a></li>
        <li><a href="/documentation/v1/tooling/compiling.html" class="nav-link">Compiling</a></li>
        <li><a href="/documentation/v1/tooling/devtool.html" class="nav-link">Devtool</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container integrations">
  <a class="nav-link">Integrations</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/documentation/v1/int-vanilla/" class="nav-link">Vanilla js</a></li>
        <li><a href="/documentation/v1/int-react/" class="nav-link">React</a></li>
        <li><a href="/documentation/v1/int-vue/" class="nav-link">Vue</a></li>
        <li><a href="/documentation/v1/int-svelte/" class="nav-link">Svelte</a></li>
        <li><a href="/documentation/v1/int-others/" class="nav-link">Others</a></li>
      </ul>
    </li>
  </ul>
</li>

<li>
  <a href="/documentation/v1/testing/index.html" class="nav-link team">Testing</a>
</li>
<li>
  <a href="/documentation/v1/contributed/index.html" class="nav-link team">Blog</a>
</li>

    </ul>
    <div class="list">
      
        <h2>
          
          API
          
            <select class="version-select">
              <option value="SELF" selected>1.0</option>
            </select>
          
        </h2>
        <ul class="menu-root">
  
    
    
    
    <li>
      <a href="/documentation/v1/api/index.html" class="sidebar-link">Overview</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/api/createStateMachine.html" class="sidebar-link current">createStateMachine</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/api/createPureStateMachine.html" class="sidebar-link">createPureStateMachine</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/api/makeWebComponent.html" class="sidebar-link">makeWebComponentFromFsm</a>
    </li>
  
    
    
    
    <li>
      <a href="/documentation/v1/api/terminology.html" class="sidebar-link">Terminology</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>



<div class="content api with-sidebar ">
  
    
    
  
  
    <h1>createStateMachine</h1>
  
  
    <p><code>createStateMachine :: FSM_Def -&gt; FSM_Settings -&gt; Stateful_FSM</code></p>
<h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>This FSM factory function takes parameters defining the behavior of the state machine and returns the created state machine. The created state machine is a regular JavaScript function that you call with the inputs to be processed by the machine. The function computes the machine’s outputs. The syntax for an input is <code>{[eventLabel] : eventData}</code>, i.e. an input is an object with exactly one key, which is the event identifier, and the value matching the key is the event data.</p>
<p>The machine additionally may carry over environment variables, which are accessible in guards, and action factories. This helps to maintain such functions pure and testable. Environment variables can also be used to parameterize the state machine’s behavior.</p>
<p>Better than words, we recall here the <a href="https://brucou.github.io/documentation/v1/examples/counter-application.html">counter application example</a>:</p>
<p><img src="../../graphs/trivial counter machine.png" alt="counter machine"></p>
<iframe src="https://codesandbox.io/embed/w6x42521n7?fontsize=12&hidenavigation=1" title="Counter app" style="width:1000px; height:700px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<pre><code class="hljs js">...

const fsmDef = &#123;
  <span class="hljs-attr">states</span>: &#123; <span class="hljs-attr">counting</span>: <span class="hljs-string">""</span> &#125;,
  <span class="hljs-attr">events</span>: [<span class="hljs-string">"clicked"</span>],
  <span class="hljs-attr">initialExtendedState</span>: &#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> &#125;,
  <span class="hljs-attr">initialControlState</span>: <span class="hljs-string">"counting"</span>,
  <span class="hljs-attr">transitions</span>: [
    &#123;
      <span class="hljs-attr">from</span>: <span class="hljs-string">"counting"</span>,
      <span class="hljs-attr">event</span>: <span class="hljs-string">"clicked"</span>,
      <span class="hljs-attr">to</span>: <span class="hljs-string">"counting"</span>,
      <span class="hljs-attr">action</span>: incCounterAndDisplay
    &#125;
  ],
  updateState
&#125;;

...

const settings = &#123; <span class="hljs-attr">debug</span>: &#123; <span class="hljs-built_in">console</span> &#125;, <span class="hljs-attr">devTool</span>: &#123; tracer &#125; &#125;;
<span class="hljs-keyword">const</span> fsm = createStateMachine(fsmDef, settings);

...
  const commands = fsm(&#123; <span class="hljs-attr">clicked</span>: <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> &#125;);</code></pre>
<p>You can go back and forth to the code sample while you are reviewing the detailed type information from subsequent sections. Let’s now dive into the details. Additionally, you may also refer to the test examples from the <a href="https://github.com/brucou/kingly/blob/master/test/hierarchy.specs.js" target="_blank" rel="noopener">test directory</a>.</p>
<h3 id="FSM-Def"><a href="#FSM-Def" class="headerlink" title="FSM_Def"></a>FSM_Def</h3><p>The <a href="https://github.com/brucou/kingly/blob/master/src/types.js" target="_blank" rel="noopener">type</a> is as follows:</p>
<pre><code class="hljs js"><span class="hljs-comment">/**
 * @typedef &#123;Object&#125; FSM_Def
 * @property &#123;FSM_States&#125; states Object whose every key is a control state admitted by the
 * specified state machine. The value associated to that key is unused in the present version of the library. The
 * hierarchy of the states correspond to property nesting in the `states` object
 * @property &#123;Array&lt;EventLabel&gt;&#125; events A list of event monikers the machine is configured to react to
 * @property &#123;Array&lt;Transition&gt;&#125; transitions An array of transitions the machine is allowed to take
 * @property &#123;*&#125; initialExtendedState The initial value for the machine's extended state
 * @property &#123;function(ExtendedState, ExtendedStateUpdate) : ExtendedState&#125; updateState function
 * which update the extended state of the state machine
 */</span></code></pre>
<h4 id="states"><a href="#states" class="headerlink" title="states"></a><code>states</code></h4><p><code>states</code> reflects the state hierarchy of the machine in its object hierarchy: </p>
<ul>
<li>The previous counter application will thus have only one single state defined at the top level: <code>states = {counting: &quot;&quot;&quot;}</code></li>
<li>The <a href="https://github.com/brucou/keypad-fsm/blob/master/src/index.js" target="_blank" rel="noopener">keypad example</a> will have:<br> <code>states = {                                    [NO_PIN]: &quot;&quot;,   [PIN]: &quot;&quot;, [DONE]: &quot;&quot;,                                  };</code><br><a href="../examples/keypad.html"><img src="https://brucou.github.io/documentation/graphs/keypad%20machine.png" alt="keypad machine"></a></li>
<li>The <a href="http://localhost:4000/documentation/v1/tutorials/chess-game.html" target="_blank" rel="noopener">basic two-player chess game</a> from the tutorial will have:</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>Graph</th>
<th>States object</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="../../graphs/chess%20game%20with%20hierarchy%20no%20undo.jpg" alt="chess game no undo"></td>
<td><pre><code class="hljs js"><span class="hljs-keyword">const</span> states = &#123;
  [OFF]: <span class="hljs-string">""</span>,
  [WHITE_TURN]: &#123;
    [WHITE_PLAYS]: <span class="hljs-string">""</span>,
    [WHITE_PIECE_SELECTED]: <span class="hljs-string">""</span>
  &#125;,
  [BLACK_TURN]: &#123;
    [BLACK_PLAYS]: <span class="hljs-string">""</span>,
    [BLACK_PIECE_SELECTED]: <span class="hljs-string">""</span>
  &#125;,
  [GAME_OVER]: <span class="hljs-string">""</span>,
&#125;;</code></pre></td>
</tr>
</tbody>
</table>
</div>
<p>Note how in the last example the <em>White turn</em> ccmpound state’s two sub-states are encoded in the <code>states</code> object.</p>
<h4 id="events"><a href="#events" class="headerlink" title="events"></a><code>events</code></h4><p>You can refer to the <a href="../tutorials">tutorials</a> for examples. For the password meter, <code>events = [TYPED_CHAR, CLICKED_SUBMIT, START];</code></p>
<h4 id="transitions"><a href="#transitions" class="headerlink" title="transitions"></a><code>transitions</code></h4><p>The <code>transitions</code> is the most complex parameter of the <code>createStateMachine</code> factory function as it encodes the machine graph. The translation of the machine into the <code>transitions</code> object is however relatively simple. There are two kind of transition records: inconditional transition, i.e. transitions that do not have guards applying, and conditional transitions, which do.</p>
<ul>
<li><p>Inconditional transitions have the following type:</p>
<pre><code class="hljs js"><span class="hljs-comment">/**
 * @typedef &#123;&#123;from: ControlState, to: ControlState|HistoryState, event?: EventLabel, action: ActionFactory&#125;&#125; InconditionalTransition
 *   Inconditional_Transition encodes transition with no guards attached. Every time the specified event occurs, and
 *   the machine is in the specified state, it will transition to the target control state, and invoke the action
 *   returned by the action factory
 */</span></code></pre>
</li>
<li><p>Conditional transitions have the following type:</p>
<pre><code class="hljs js"><span class="hljs-comment">/**
 * @typedef &#123;&#123;from: ControlState, event?: EventLabel, guards: Array&lt;Condition&gt;&#125;&#125; ConditionalTransition Transition for the
 * specified state is contingent to some guards being passed. Those guards are defined as an array.
 */</span></code></pre>
</li>
<li><p>A condition has the following type:</p>
<pre><code class="hljs js"><span class="hljs-comment">/**
 * @typedef &#123;&#123;predicate: FSM_Predicate, to: ControlState|HistoryState, action: ActionFactory&#125;&#125; Condition On satisfying the
 * specified predicate, the received event data will trigger the transition to the specified target control state
 * and invoke the action created by the specified action factory, leading to an update of the internal state of the
 * extended state machine and possibly an output to the state machine client.
 */</span></code></pre>
</li>
<li><p>A guard has the following type:</p>
<pre><code class="hljs js"><span class="hljs-comment">/** @typedef &#123;function (ExtendedState, EventData, FSM_Settings) : Boolean&#125; FSM_Predicate */</span></code></pre>
</li>
</ul>
<p>The <code>settings</code> parameter passed to the guard is identical to the one passed at machine creation’s time. The extended state passed as first parameter is that which is encapsulated in the machine at the moment when the event is received. The event data is the data that is carried with the event being processed by the machine.</p>
<ul>
<li>An action factory has the following type:<pre><code class="hljs js"><span class="hljs-comment">/**
 * @typedef &#123;function(ExtendedState, EventData, FSM_Settings) : Actions&#125; ActionFactory
 */</span></code></pre>
</li>
</ul>
<p>The <code>settings</code> parameter passed to the action factory is identical to the one passed at machine creation’s time. The extended state passed as first parameter is that which is encapsulated in the machine at the moment when the event is received. The event data is the data that is carried with the event being processed by the machine.</p>
<p>The important point here is that action factories return <code>Actions</code> that produce two things: updates to the encapsulated state of the machine; and the machine outputs. The machine outputs are the actual commands that are to be executed by the machine clients. The updates of the encapsulated state are not visible from an API client. Again, we refer the reader to the <a href="../tutorials">tutorials</a> for concrete examples of using action factories.</p>
<ul>
<li>History pseudo-states are generated by a helper function <code>historyState :: HistoryType -&gt; ControlState -&gt; HistoryPseudoState</code>. A history state is coupled to a compound control state and has a type (deep or shallow). Passing this information to the factory produces the sought history state. </li>
</ul>
<p>The reader can refer to the <a href="../tutorials/chess-game-ultimate.html">chess game tutorial (with undo functionality)</a> to see an example of complex configuration that involves history states, atomic states, compound states, and guards. Here goes an excerpt that features eventless transitions (<code>event: void 0</code>), transitions to history states, transitions from compound states to the initial state of the compound state, and transitions between atomic states:</p>
<pre><code class="hljs js"><span class="hljs-keyword">const</span> transitions = [
  &#123; <span class="hljs-attr">from</span>: OFF, <span class="hljs-attr">event</span>: START, <span class="hljs-attr">to</span>: GAME_ON, <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
  &#123; <span class="hljs-attr">from</span>: GAME_ON, <span class="hljs-attr">event</span>: INIT_EVENT, <span class="hljs-attr">to</span>: WHITE_TURN, <span class="hljs-attr">action</span>: resetAndStartTimer &#125;,
  &#123; <span class="hljs-attr">from</span>: WHITE_TURN, <span class="hljs-attr">event</span>: INIT_EVENT, <span class="hljs-attr">to</span>: WHITE_PLAYS, <span class="hljs-attr">action</span>: displayInitScreen &#125;,
  &#123; <span class="hljs-attr">from</span>: GAME_ON, <span class="hljs-attr">event</span>: TICK, <span class="hljs-attr">to</span>: UPDATING_CLOCK, <span class="hljs-attr">action</span>: updateAndDisplayClock &#125;,
  &#123; <span class="hljs-attr">from</span>: UPDATING_CLOCK, <span class="hljs-attr">event</span>: <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>, <span class="hljs-attr">to</span>: historyState(DEEP, GAME_ON), <span class="hljs-attr">action</span>: ACTION_IDENTITY &#125;,
  &#123; <span class="hljs-attr">from</span>: GAME_ON, <span class="hljs-attr">event</span>: CLOCK_CLICKED, <span class="hljs-attr">to</span>: PAUSED_CLOCK, <span class="hljs-attr">action</span>: pauseClock &#125;,
  &#123; <span class="hljs-attr">from</span>: PAUSED_CLOCK, <span class="hljs-attr">event</span>: CLOCK_CLICKED, <span class="hljs-attr">to</span>: historyState(DEEP, GAME_ON), <span class="hljs-attr">action</span>: resumeClock &#125;,
  (...)
];</code></pre>
<p>If there is any missing information, you may refer to the <a href="https://github.com/brucou/kingly/blob/master/src/types.js" target="_blank" rel="noopener">types file</a> in the project repository. You may also <a href="https://github.com/brucou/kingly/issues/new" target="_blank" rel="noopener">leave us a comment</a>, we will update the documentation to reflect the missing information.</p>
<h4 id="initial-extended-state"><a href="#initial-extended-state" class="headerlink" title="initial extended state"></a><code>initial extended state</code></h4><p>This parameter holds the initial extended state for the machine.</p>
<h4 id="updateState"><a href="#updateState" class="headerlink" title="updateState"></a><code>updateState</code></h4><p>This parameter is a reducer function that takes a state and a series of updates to compute an update state: <code>updateState: function(ExtendedState, ExtendedStateUpdates) : ExtendedState</code>. <code>ExtendedStateUpdates</code> MUST be an array. The empty array is used by default to indicate the absence of modifications of the extended state.</p>
<p>The <code>updateState</code> property is mandatory. We successfully used <a href="http://jsonpatch.com/" target="_blank" rel="noopener">JSON patch</a> operations for model updates, but you can choose to use the immutable library of your choice or a simple reducer. The important point is that the extended state <strong>should not be modified in place</strong>, i.e. <code>updateState</code> should be a pure function. You can relax that condition in some trivial cases where you do not need immutability (e.g., specific and limited tests). In the general case, do not shoot yourself in the feet. Bugs due to mutability are incredibly hard to trace back to their origin.</p>
<h3 id="FSM-Settings"><a href="#FSM-Settings" class="headerlink" title="FSM_Settings"></a><code>FSM_Settings</code></h3><p>The <code>settings.debug.checkContracts</code>, when set, represents contracts that the state machine must fulfill. The <code>kingly</code> library comes by default with a set of contracts enforcing most of the syntax and semantics of the state machine format chosen. The contracts will for instance prevent you from using control states that are never used in transitions (e.g., unreachable control states), or eventless transitions that return to the origin control state (possibility of blocking infinite loop). If you are just starting to use Kingly, we recommend setting the option to avoid trivial errors that will appear as you get familiarized with the API and state machine semantics. The contracts have been tested across a few dozen users and should catch most of the common errors.</p>
<p>Kingly’s contracts can be imported with <code>import { fsmContracts } from &quot;kingly&quot;</code> and assigned to the<br><code>settings.debug.checkContracts</code> property.</p>
<p>The <code>settings.debug.console</code>, when set, represents a <code>console</code> object through which tracing and debug info will flow. This is useful in development and can be turned off in production. This console object must have the following properties: <code>log</code>, <code>info</code>, <code>debug</code>, <code>warn</code>, <code>error</code>, <code>group</code>, and <code>groupEnd</code>.</p>
<p>Example of use of debugging parameters can be found in the <a href="../tutorials/counter-application.html">counter application tutorial</a>.</p>
<h3 id="Stateful-FSM"><a href="#Stateful-FSM" class="headerlink" title="Stateful_FSM"></a>Stateful_FSM</h3><p>The machine returned by <code>createStateMachine</code> is a function that take one single parameter that is an object with only one property: the moniker of the event to be processed. The value of that property is the event data:</p>
<pre><code class="hljs js"><span class="hljs-comment">/**
 * @callback Stateful_FSM
 * @param &#123;Object.&lt;EventLabel, EventData&gt;&#125; input
 * @returns &#123;FSM_Outputs|Error&#125;
 */</span></code></pre>
<p>The machine returns an array of outputs or an Error object. The machine may actually also throw if an unexpected error occurs. Unexpected error should be internal errors, as user-provided functions are<br>guarded against exceptions.</p>
<p>Example of use of the type can be found in the <a href="../tutorials/counter-application.html">counter application tutorial</a>.</p>
<h2 id="Contracts"><a href="#Contracts" class="headerlink" title="Contracts"></a>Contracts</h2><p>The enforced contracts, taken from the <a href="https://github.com/brucou/kingly/blob/master/src/contracts.js" target="_blank" rel="noopener">codebase</a> as of March 2021, are as follows:<br><pre><code class="hljs undefined">
// S2. State names must be unique
// S1. State name cannot be a reserved state name (for now only INIT_STATE)
// S4. At least one control state (other than the initial state) muat be declared
// S5. check initial control state is a defined state in states
// E0. `fsmDef.events` msut be an array of strings
// T1. There must be configured at least one transition away from the initial state
// T2. A transition away from the initial state can only be triggered by the initial event
// T7b. The initial state must have a valid transition INIT_STATE -INIT-&gt; defined which does not have a history
// state as target
// T23. We allow conditional initial transitions, but what about the action ? should it be always identity? We
// can&apos;t run any actions. We can update internal state, but we can&apos;t trace it, so we loose tracing properties and
// debugging!. So enforce ACTIONS to be identity
// T15. Init transitions can only occur from compound states or the initial state, i.e. A -INIT-&gt; B iff A is a compound
// state or A is the initial state
// T5. Every compound state NOT the initial state A must have a valid transition A -INIT-&gt; defined
// T7a. Every compound state NOT the initial state must have a valid INCONDITIONAL transition A -INIT-&gt; defined which
// does not have a history state as target
// NOTE: actually we could limit it to history state of the containing compound state to avoid infinity loop
// T8. Every compound state NOT the initial state must have a valid INCONDITIONAL transition A -INIT-&gt; defined which
// does not have the history state as target and has a target control state that is one of its substates (no
// out-of-hierarchy INIT transitions)
// T11. If there is an eventless transition A -eventless-&gt; B, there cannot be a competing A -ev-&gt; X
// T24. Check that we have this implicitly : Compound states must not have eventless transitions
// defined on them (would introduce ambiguity with the INIT transition).
// T12. All transitions A -ev-&gt; * must have the same transition index, i.e. all associated guards must be together
// in a single array and there cannot be two transition rows showcasing A -ev-&gt; * transitions
// T14. Conflicting transitions are not allowed, i.e. A -ev-&gt; B and A &lt; OUTER_A
// with ev non reserved event (init event or eventless) is not compatible with OUTER_A-ev-&gt;C.
// The event `ev` could trigger a transition towards either B or C
// T16.a History states must be target states
// T16.b History states must be compound states
// T17 An history state must refer to an existing state
// T18. Transitions have a valid format, and are either inconditional (no guards) or conditional
// events are strings
// guards are functions
// action factories are functions
// T25. SS1 - as of v0.13 settings is no longer mandatory
// T22. There are no incoming transitions to the reserved initial state, check if implemented or not, prob. not
// T23. eventless self-transitions are forbidden (while theoretically possible, the feature is of
// little practical value, though being a possible source of ambiguity or infinite loops)
// A -_&gt; A impossible on compound states because there is A -INIT-&gt; X
// so only possibility is A -_&gt; A with A atomic state

- All [previously mentioned](https://github.com/brucou/kingly#contracts) contracts apply.
- [Type contracts](https://github.com/brucou/kingly/blob/master/src/types.js)
- The `settings.updateState` property is mandatory!
- The `settings` property **should not be modified** after being passed as parameter (i.e. should be a constant): it is not cloned and is passed to all relevant functions (guards, etc.)</code></pre></p>
<p>Some of these contracts are type contracts that are checked at runtime. Others are semantic contracts that filter out many pathological machines, possibly saving you hours of debugging sessions.</p>

  
  
  <div class="footer">
    Caught a mistake?
    <a href="https://github.com/brucou/kingly-site/tree/master/src/v1/api/createStateMachine.md" rel="noopener" target="_blank">
            Edit this on GitHub!
    </a><br>
    Can we help you?     <a href="https://github.com/brucou/kingly/issues/new" rel="noopener" target="_blank">
      Let us know!
    </a>
  </div>
</div>

      </div>
      <script src="/documentation/js/smooth-scroll.min.js"></script>
    

    <!-- script for sidebars, version selects etc. -->
    <script src="/documentation/js/css.escape.js"></script>
    <script src="/documentation/js/common.js"></script>
    <!-- mathjax-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
</html>
